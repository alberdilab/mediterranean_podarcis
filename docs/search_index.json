[["index.html", "AlberdiLab | Manuscript in prep Mediterranean podarcis metagenomics Chapter 1 Introduction 1.1 Prepare the R environment", " AlberdiLab | Manuscript in prep Mediterranean podarcis metagenomics Antton Alberdi1 2024-06-21 Chapter 1 Introduction 1.1 Prepare the R environment 1.1.1 Environment To reproduce all the analyses locally, clone this repository in your computer using: RStudio &gt; New Project &gt; Version Control &gt; Git And indicating the following git repository: https://github.com/alberdilab/mediterranean_podarcis.git Once the R project has been created, follow the instructions and code chunks shown in this webbook. 1.1.2 Libraries The following R packages are required for the data analysis. # Base library(R.utils) library(knitr) library(tidyverse) library(devtools) library(tinytable) library(rairtable) # For tree handling library(ape) library(phyloseq) library(phytools) # For plotting library(ggplot2) library(ggrepel) library(ggpubr) library(ggnewscale) library(gridExtra) library(ggtreeExtra) library(ggtree) library(ggh4x) # For statistics library(spaa) library(vegan) library(Rtsne) library(geiger) library(hilldiv2) library(distillR) library(broom.mixed) #library(lmerTest) library(Hmsc) library(corrplot) University of Copenhagen, antton.alberdi@sund.ku.dk↩︎ "],["data-preparation.html", "Chapter 2 Data preparation 2.1 Podarcis filfolensis (PF) 2.2 Podarcis gaigeae (PG) 2.3 Podarcis milensis (PM) 2.4 Podarcis pityusensis (PP) 2.5 All", " Chapter 2 Data preparation 2.1 Podarcis filfolensis (PF) 2.1.0.1 Sample metadata sample_metadata_pf &lt;- read_tsv(&quot;data/pf/DMB0159_metadata.tsv.gz&quot;) %&gt;% rename(sample=1) 2.1.0.2 Genome metadata genome_metadata_pf &lt;- read_tsv(&quot;data/pf/DMB0159_mag_info.tsv.gz&quot;) %&gt;% rename(length=mag_size) 2.1.0.3 Read counts read_counts_pf &lt;- read_tsv(&quot;data/pf/DMB0159_counts.tsv.gz&quot;) %&gt;% rename(genome=1) %&gt;% select(all_of(c(&quot;genome&quot;,sample_metadata_pf$sample))) %&gt;% # sort samples arrange(match(genome,genome_metadata_pf$genome)) # sort genomes 2.1.0.4 Genome base hits genome_coverage_pf &lt;- read_tsv(&quot;data/pf/DMB0159_coverage.tsv.gz&quot;) %&gt;% rename(genome=1) %&gt;% select(all_of(c(&quot;genome&quot;,sample_metadata_pf$sample))) %&gt;% # sort samples arrange(match(genome,genome_metadata_pf$genome)) # sort genomes 2.1.0.5 Genome tree genome_tree_pf &lt;- read_tree(&quot;data/pf/DMB0159.tree&quot;) genome_tree_pf$tip.label &lt;- str_replace_all(genome_tree_pf$tip.label,&quot;&#39;&quot;, &quot;&quot;) #remove single quotes in MAG names genome_tree_pf &lt;- keep.tip(genome_tree_pf, tip=genome_metadata_pf$genome) # keep only MAG tips 2.1.0.6 Genome annotations Downloading individual annotation files from ERDA using information in Airtable and writing them to a single compressed table takes a while. The following chunk only needs to be run once, to generate the genome_annotations table that is saved in the data directory. Note that the airtable connection requires a personal access token. airtable(&quot;MAGs&quot;, &quot;appWbHBNLE6iAsMRV&quot;) %&gt;% #get base ID from Airtable browser URL read_airtable(., fields = c(&quot;ID&quot;,&quot;mag_name&quot;,&quot;number_genes&quot;,&quot;anno_url&quot;), id_to_col = TRUE) %&gt;% #get 3 columns from MAGs table filter(mag_name %in% paste0(genome_metadata_pf$genome,&quot;.fa&quot;)) %&gt;% #filter by MAG name filter(number_genes &gt; 0) %&gt;% #genes need to exist select(anno_url) %&gt;% #list MAG annotation urls pull() %&gt;% read_tsv() %&gt;% #load all tables rename(gene=1, genome=2, contig=3) %&gt;% #rename first 3 columns write_tsv(file=&quot;data/pf/genome_annotations.tsv.xz&quot;) #write to overall compressed file genome_annotations_pf &lt;- read_tsv(&quot;data/pf/genome_annotations.tsv.xz&quot;) %&gt;% rename(gene=1, genome=2, contig=3) 2.1.0.7 Create working objects Transform the original data files into working objects for downstream analyses. 2.1.0.8 Filter reads by coverage min_coverage=0.3 read_counts_filt_pf &lt;- genome_coverage_pf %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts_pf[[cur_column()]])) 2.1.0.9 Transform reads into genome counts readlength=150 genome_counts_pf &lt;- read_counts_pf %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata_pf$length / readlength) )) readlength=150 genome_counts_filt_pf &lt;- read_counts_filt_pf %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata_pf$length / readlength) )) 2.1.0.10 Distill annotations into GIFTs genome_gifts_pf &lt;- distill(genome_annotations_pf,GIFT_db,genomecol=2,annotcol=c(9,10,19), verbosity=F) 2.1.0.11 Prepare color scheme AlberdiLab projects use unified color schemes developed for the Earth Hologenome Initiative, to facilitate figure interpretation. phylum_colors_pf &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata_pf, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree_pf$tip.label)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% pull(colors, name=phylum) 2.1.0.12 Wrap working objects All working objects are wrapped into a single Rdata object to facilitate downstream usage. save(sample_metadata_pf, genome_metadata_pf, read_counts_pf, genome_counts_pf, genome_counts_filt_pf, genome_tree_pf, genome_gifts_pf, phylum_colors_pf, file = &quot;data/data_podarcis_filfolensis.Rdata&quot;) 2.2 Podarcis gaigeae (PG) 2.2.0.1 Sample metadata sample_metadata_pg &lt;- read_tsv(&quot;data/pg/DMB0160_metadata.tsv.gz&quot;) %&gt;% rename(sample=1) 2.2.0.2 Genome metadata genome_metadata_pg &lt;- read_tsv(&quot;data/pg/DMB0160_mag_info.tsv.gz&quot;) %&gt;% rename(length=mag_size) 2.2.0.3 Read counts read_counts_pg &lt;- read_tsv(&quot;data/pg/DMB0160_counts.tsv.gz&quot;) %&gt;% rename(genome=1) %&gt;% select(all_of(c(&quot;genome&quot;,sample_metadata_pg$sample))) %&gt;% # sort samples arrange(match(genome,genome_metadata_pg$genome)) # sort genomes 2.2.0.4 Genome base hits genome_coverage_pg &lt;- read_tsv(&quot;data/pg/DMB0160_coverage.tsv.gz&quot;) %&gt;% rename(genome=1) %&gt;% select(all_of(c(&quot;genome&quot;,sample_metadata_pg$sample))) %&gt;% # sort samples arrange(match(genome,genome_metadata_pg$genome)) # sort genomes 2.2.0.5 Genome tree genome_tree_pg &lt;- read_tree(&quot;data/pg/DMB0160.tree&quot;) genome_tree_pg$tip.label &lt;- str_replace_all(genome_tree_pg$tip.label,&quot;&#39;&quot;, &quot;&quot;) #remove single quotes in MAG names genome_tree_pg &lt;- keep.tip(genome_tree_pg, tip=genome_metadata_pg$genome) # keep only MAG tips 2.2.0.6 Genome annotations Downloading individual annotation files from ERDA using information in Airtable and writing them to a single compressed table takes a while. The following chunk only needs to be run once, to generate the genome_annotations table that is saved in the data directory. Note that the airtable connection requires a personal access token. airtable(&quot;MAGs&quot;, &quot;appWbHBNLE6iAsMRV&quot;) %&gt;% #get base ID from Airtable browser URL read_airtable(., fields = c(&quot;ID&quot;,&quot;mag_name&quot;,&quot;number_genes&quot;,&quot;anno_url&quot;), id_to_col = TRUE) %&gt;% #get 3 columns from MAGs table filter(mag_name %in% paste0(genome_metadata_pg$genome,&quot;.fa&quot;)) %&gt;% #filter by MAG name filter(number_genes &gt; 0) %&gt;% #genes need to exist select(anno_url) %&gt;% #list MAG annotation urls pull() %&gt;% read_tsv() %&gt;% #load all tables rename(gene=1, genome=2, contig=3) %&gt;% #rename first 3 columns write_tsv(file=&quot;data/pg/genome_annotations.tsv.xz&quot;) #write to overall compressed file genome_annotations_pg &lt;- read_tsv(&quot;data/pg/genome_annotations.tsv.xz&quot;) %&gt;% rename(gene=1, genome=2, contig=3) 2.2.0.7 Create working objects Transform the original data files into working objects for downstream analyses. 2.2.0.8 Filter reads by coverage min_coverage=0.3 read_counts_filt_pg &lt;- genome_coverage_pg %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts_pg[[cur_column()]])) 2.2.0.9 Transform reads into genome counts readlength=150 genome_counts_pg &lt;- read_counts_pg %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata_pg$length / readlength) )) readlength=150 genome_counts_filt_pg &lt;- read_counts_filt_pg %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata_pg$length / readlength) )) 2.2.0.10 Distill annotations into GIFTs genome_gifts_pg &lt;- distill(genome_annotations_pg,GIFT_db,genomecol=2,annotcol=c(9,10,19), verbosity=F) 2.2.0.11 Prepare color scheme AlberdiLab projects use unified color schemes developed for the Earth Hologenome Initiative, to facilitate figure interpretation. phylum_colors_pg &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata_pg, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree_pg$tip.label)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% pull(colors, name=phylum) 2.2.0.12 Wrap working objects All working objects are wrapped into a single Rdata object to facilitate downstream usage. save(sample_metadata_pg, genome_metadata_pg, read_counts_pg, genome_counts_pg, genome_counts_filt_pg, genome_tree_pg, genome_gifts_pg, phylum_colors_pg, file = &quot;data/data_podarcis_gaigeae.Rdata&quot;) 2.3 Podarcis milensis (PM) 2.3.0.1 Sample metadata sample_metadata_pm &lt;- read_tsv(&quot;data/pm/DMB0158_metadata.tsv.gz&quot;) %&gt;% rename(sample=1) 2.3.0.2 Genome metadata genome_metadata_pm &lt;- read_tsv(&quot;data/pm/DMB0158_mag_info.tsv.gz&quot;) %&gt;% rename(length=mag_size) 2.3.0.3 Read counts read_counts_pm &lt;- read_tsv(&quot;data/pm/DMB0158_counts.tsv.gz&quot;) %&gt;% rename(genome=1) %&gt;% select(all_of(c(&quot;genome&quot;,sample_metadata_pm$sample))) %&gt;% # sort samples arrange(match(genome,genome_metadata_pm$genome)) # sort genomes 2.3.0.4 Genome base hits genome_coverage_pm &lt;- read_tsv(&quot;data/pm/DMB0158_coverage.tsv.gz&quot;) %&gt;% rename(genome=1) %&gt;% select(all_of(c(&quot;genome&quot;,sample_metadata_pm$sample))) %&gt;% # sort samples arrange(match(genome,genome_metadata_pm$genome)) # sort genomes 2.3.0.5 Genome tree genome_tree_pm &lt;- read_tree(&quot;data/pm/DMB0158.tree&quot;) genome_tree_pm$tip.label &lt;- str_replace_all(genome_tree_pm$tip.label,&quot;&#39;&quot;, &quot;&quot;) #remove single quotes in MAG names genome_tree_pm &lt;- keep.tip(genome_tree_pm, tip=genome_metadata_pm$genome) # keep only MAG tips 2.3.0.6 Genome annotations Downloading individual annotation files from ERDA using information in Airtable and writing them to a single compressed table takes a while. The following chunk only needs to be run once, to generate the genome_annotations table that is saved in the data directory. Note that the airtable connection requires a personal access token. airtable(&quot;MAGs&quot;, &quot;appWbHBNLE6iAsMRV&quot;) %&gt;% #get base ID from Airtable browser URL read_airtable(., fields = c(&quot;ID&quot;,&quot;mag_name&quot;,&quot;number_genes&quot;,&quot;anno_url&quot;), id_to_col = TRUE) %&gt;% #get 3 columns from MAGs table filter(mag_name %in% paste0(genome_metadata_pm$genome,&quot;.fa&quot;)) %&gt;% #filter by MAG name filter(number_genes &gt; 0) %&gt;% #genes need to exist select(anno_url) %&gt;% #list MAG annotation urls pull() %&gt;% read_tsv() %&gt;% #load all tables rename(gene=1, genome=2, contig=3) %&gt;% #rename first 3 columns write_tsv(file=&quot;data/pm/genome_annotations.tsv.xz&quot;) #write to overall compressed file genome_annotations_pm &lt;- read_tsv(&quot;data/pm/genome_annotations.tsv.xz&quot;) %&gt;% rename(gene=1, genome=2, contig=3) 2.3.0.7 Create working objects Transform the original data files into working objects for downstream analyses. 2.3.0.8 Filter reads by coverage min_coverage=0.3 read_counts_filt_pm &lt;- genome_coverage_pm %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts_pm[[cur_column()]])) 2.3.0.9 Transform reads into genome counts readlength=150 genome_counts_pm &lt;- read_counts_pm %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata_pm$length / readlength) )) readlength=150 genome_counts_filt_pm &lt;- read_counts_filt_pm %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata_pm$length / readlength) )) 2.3.0.10 Distill annotations into GIFTs genome_gifts_pm &lt;- distill(genome_annotations_pm,GIFT_db,genomecol=2,annotcol=c(9,10,19), verbosity=F) 2.3.0.11 Prepare color scheme AlberdiLab projects use unified color schemes developed for the Earth Hologenome Initiative, to facilitate figure interpretation. phylum_colors_pm &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata_pm, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree_pm$tip.label)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% pull(colors, name=phylum) 2.3.0.12 Wrap working objects All working objects are wrapped into a single Rdata object to facilitate downstream usage. save(sample_metadata_pm, genome_metadata_pm, read_counts_pm, genome_counts_pm, genome_counts_filt_pm, genome_tree_pm, genome_gifts_pm, phylum_colors_pm, file = &quot;data/data_podarcis_milensis.Rdata&quot;) 2.4 Podarcis pityusensis (PP) 2.4.0.1 Sample metadata sample_metadata_pp &lt;- read_tsv(&quot;data/pp/DMB0161_metadata.tsv.gz&quot;) %&gt;% rename(sample=1) 2.4.0.2 Genome metadata genome_metadata_pp &lt;- read_tsv(&quot;data/pp/DMB0161_mag_info.tsv.gz&quot;) %&gt;% rename(length=mag_size) 2.4.0.3 Read counts read_counts_pp &lt;- read_tsv(&quot;data/pp/DMB0161_counts.tsv.gz&quot;) %&gt;% rename(genome=1) %&gt;% select(all_of(c(&quot;genome&quot;,sample_metadata_pp$sample))) %&gt;% # sort samples arrange(match(genome,genome_metadata_pp$genome)) # sort genomes 2.4.0.4 Genome base hits genome_coverage_pp &lt;- read_tsv(&quot;data/pp/DMB0161_coverage.tsv.gz&quot;) %&gt;% rename(genome=1) %&gt;% select(all_of(c(&quot;genome&quot;,sample_metadata_pp$sample))) %&gt;% # sort samples arrange(match(genome,genome_metadata_pp$genome)) # sort genomes 2.4.0.5 Genome tree genome_tree_pp &lt;- read_tree(&quot;data/pp/DMB0161.tree&quot;) genome_tree_pp$tip.label &lt;- str_replace_all(genome_tree_pp$tip.label,&quot;&#39;&quot;, &quot;&quot;) #remove single quotes in MAG names genome_tree_pp &lt;- keep.tip(genome_tree_pp, tip=genome_metadata_pp$genome) # keep only MAG tips 2.4.0.6 Genome annotations Downloading individual annotation files from ERDA using information in Airtable and writing them to a single compressed table takes a while. The following chunk only needs to be run once, to generate the genome_annotations table that is saved in the data directory. Note that the airtable connection requires a personal access token. airtable(&quot;MAGs&quot;, &quot;appWbHBNLE6iAsMRV&quot;) %&gt;% #get base ID from Airtable browser URL read_airtable(., fields = c(&quot;ID&quot;,&quot;mag_name&quot;,&quot;number_genes&quot;,&quot;anno_url&quot;), id_to_col = TRUE) %&gt;% #get 3 columns from MAGs table filter(mag_name %in% paste0(genome_metadata_pp$genome,&quot;.fa&quot;)) %&gt;% #filter by MAG name filter(number_genes &gt; 0) %&gt;% #genes need to exist select(anno_url) %&gt;% #list MAG annotation urls pull() %&gt;% read_tsv() %&gt;% #load all tables rename(gene=1, genome=2, contig=3) %&gt;% #rename first 3 columns write_tsv(file=&quot;data/pp/genome_annotations.tsv.xz&quot;) #write to overall compressed file genome_annotations_pp &lt;- read_tsv(&quot;data/pp/genome_annotations.tsv.xz&quot;) %&gt;% rename(gene=1, genome=2, contig=3) 2.4.0.7 Create working objects Transform the original data files into working objects for downstream analyses. 2.4.0.8 Filter reads by coverage min_coverage=0.3 read_counts_filt_pp &lt;- genome_coverage_pp %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts_pp[[cur_column()]])) 2.4.0.9 Transform reads into genome counts readlength=150 genome_counts_pp &lt;- read_counts_pp %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata_pp$length / readlength) )) readlength=150 genome_counts_filt_pp &lt;- read_counts_filt_pp %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata_pp$length / readlength) )) 2.4.0.10 Distill annotations into GIFTs genome_gifts_pp &lt;- distill(genome_annotations_pp,GIFT_db,genomecol=2,annotcol=c(9,10,19), verbosity=F) 2.4.0.11 Prepare color scheme AlberdiLab projects use unified color schemes developed for the Earth Hologenome Initiative, to facilitate figure interpretation. phylum_colors_pp &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata_pp, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree_pp$tip.label)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% pull(colors, name=phylum) 2.4.0.12 Wrap working objects All working objects are wrapped into a single Rdata object to facilitate downstream usage. save(sample_metadata_pp, genome_metadata_pp, read_counts_pp, genome_counts_pp, genome_counts_filt_pp, genome_tree_pp, genome_gifts_pp, phylum_colors_pp, file = &quot;data/data_podarcis_pityusensis.Rdata&quot;) 2.5 All 2.5.0.1 Sample metadata sample_metadata_all &lt;- read_tsv(&quot;data/all/DMB0162_metadata.tsv.gz&quot;) %&gt;% rename(sample=1) %&gt;% mutate( population = case_when( species == &quot;Podarcis filfolensis&quot; ~ str_replace(population,&quot;_&quot;,&quot;_pf_&quot;), species == &quot;Podarcis gaigeae&quot; ~ str_replace(population,&quot;_&quot;,&quot;_pg_&quot;), species == &quot;Podarcis milensis&quot; ~ str_replace(population,&quot;_&quot;,&quot;_pm_&quot;), species == &quot;Podarcis pityusensis&quot; ~ str_replace(population,&quot;_&quot;,&quot;_pp_&quot;), TRUE ~ NA)) 2.5.0.2 Genome metadata genome_metadata_all &lt;- read_tsv(&quot;data/all/DMB0162_mag_info.tsv.gz&quot;) %&gt;% rename(length=mag_size) 2.5.0.3 Read counts read_counts_all &lt;- read_tsv(&quot;data/all/DMB0162_counts.tsv.gz&quot;) %&gt;% rename(genome=1) %&gt;% select(all_of(c(&quot;genome&quot;,sample_metadata_all$sample))) %&gt;% # sort samples arrange(match(genome,genome_metadata_all$genome)) # sort genomes 2.5.0.4 Genome base hits genome_coverage_all &lt;- read_tsv(&quot;data/all/DMB0162_coverage.tsv.gz&quot;) %&gt;% rename(genome=1) %&gt;% select(all_of(c(&quot;genome&quot;,sample_metadata_all$sample))) %&gt;% # sort samples arrange(match(genome,genome_metadata_all$genome)) # sort genomes 2.5.0.5 Genome tree genome_tree_all &lt;- read_tree(&quot;data/all/DMB0162.tree&quot;) genome_tree_all$tip.label &lt;- str_replace_all(genome_tree_all$tip.label,&quot;&#39;&quot;, &quot;&quot;) #remove single quotes in MAG names genome_tree_all &lt;- keep.tip(genome_tree_all, tip=genome_metadata_all$genome) # keep only MAG tips 2.5.0.6 Genome annotations genome_annotations_all &lt;- read_tsv(c(&quot;data/pf/genome_annotations.tsv.xz&quot;, &quot;data/pg/genome_annotations.tsv.xz&quot;, &quot;data/pm/genome_annotations.tsv.xz&quot;, &quot;data/pp/genome_annotations.tsv.xz&quot;)) %&gt;% rename(gene=1, genome=2, contig=3) 2.5.0.7 Create working objects Transform the original data files into working objects for downstream analyses. 2.5.0.8 Filter reads by coverage min_coverage=0.3 read_counts_filt_all &lt;- genome_coverage_all %&gt;% mutate(across(where(is.numeric), ~ ifelse(. &gt; min_coverage, 1, 0))) %&gt;% mutate(across(-1, ~ . * read_counts_all[[cur_column()]])) 2.5.0.9 Transform reads into genome counts readlength=150 genome_counts_all &lt;- read_counts_all %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata_all$length / readlength) )) readlength=150 genome_counts_filt_all &lt;- read_counts_filt_all %&gt;% mutate(across(where(is.numeric), ~ . / (genome_metadata_all$length / readlength) )) 2.5.0.10 Distill annotations into GIFTs genome_gifts_all &lt;- distill(genome_annotations_all,GIFT_db,genomecol=2,annotcol=c(9,10,19), verbosity=F) 2.5.0.11 Prepare color scheme AlberdiLab projects use unified color schemes developed for the Earth Hologenome Initiative, to facilitate figure interpretation. phylum_colors_all &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata_all, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree_all$tip.label)) %&gt;% select(phylum, colors) %&gt;% unique() %&gt;% arrange(phylum) %&gt;% pull(colors, name=phylum) 2.5.0.12 Wrap working objects All working objects are wrapped into a single Rdata object to facilitate downstream usage. save(sample_metadata_all, genome_metadata_all, read_counts_all, genome_counts_all, genome_counts_filt_all, genome_tree_all, genome_gifts_all, phylum_colors_all, file = &quot;data/data_podarcis_all.Rdata&quot;) "],["data-statistics.html", "Chapter 3 Data statistics 3.1 Sequencing reads statistics 3.2 DNA fractions 3.3 Recovered microbial fraction", " Chapter 3 Data statistics load(&quot;data/data_podarcis_filfolensis.Rdata&quot;) load(&quot;data/data_podarcis_gaigeae.Rdata&quot;) load(&quot;data/data_podarcis_milensis.Rdata&quot;) load(&quot;data/data_podarcis_pityusensis.Rdata&quot;) load(&quot;data/data_podarcis_all.Rdata&quot;) 3.1 Sequencing reads statistics bind_rows(list(sample_metadata_pf,sample_metadata_pg,sample_metadata_pm,sample_metadata_pp)) %&gt;% group_by(species) %&gt;% summarise(Individuals=n(), Populations=n_distinct(region), Total=sum(reads_post_fastp * 150 / 1000000000) %&gt;% round(2), mean=mean(reads_post_fastp * 150 / 1000000000) %&gt;% round(2), sd=sd(reads_post_fastp * 150 / 1000000000) %&gt;% round(2)) %&gt;% unite(&quot;Average&quot;,mean, sd, sep = &quot; ± &quot;, remove = TRUE) %&gt;% tt() tinytable_y6njlppggnyrm095qlsi .table td.tinytable_css_7fak21rc6o0w0yexnub8, .table th.tinytable_css_7fak21rc6o0w0yexnub8 { border-bottom: solid 0.1em #d3d8dc; } species Individuals Populations Total Average Podarcis filfolensis 41 9 168.59 4.11 ± 1.89 Podarcis gaigeae 61 15 292.33 4.79 ± 2.33 Podarcis milensis 26 8 144.23 5.55 ± 1.92 Podarcis pityusensis 44 7 212.29 4.82 ± 1.88 3.2 DNA fractions sequence_fractions_pf &lt;- read_counts_pf %&gt;% pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;value&quot;) %&gt;% group_by(sample) %&gt;% summarise(mags = sum(value)) %&gt;% left_join(sample_metadata_pf, by = join_by(sample == sample)) %&gt;% select(sample,mags,metagenomic_bases,host_bases,bases_lost_fastp_percent, singlem_fraction) %&gt;% mutate(mags_bases = mags*146) %&gt;% mutate(lowqual_bases = ((metagenomic_bases+host_bases)/(1-bases_lost_fastp_percent))-(metagenomic_bases+host_bases)) %&gt;% mutate(unmapped_bases = metagenomic_bases - mags_bases) %&gt;% mutate(unmapped_bases = ifelse(unmapped_bases &lt; 0, 0, unmapped_bases)) %&gt;% select(sample, lowqual_bases, host_bases, unmapped_bases, mags_bases, singlem_fraction) %&gt;% mutate(host_species=&quot;Podarcis filfolensis&quot;) sequence_fractions_pg &lt;- read_counts_pg %&gt;% pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;value&quot;) %&gt;% group_by(sample) %&gt;% summarise(mags = sum(value)) %&gt;% left_join(sample_metadata_pg, by = join_by(sample == sample)) %&gt;% select(sample,mags,metagenomic_bases,host_bases,bases_lost_fastp_percent, singlem_fraction) %&gt;% mutate(mags_bases = mags*146) %&gt;% mutate(lowqual_bases = ((metagenomic_bases+host_bases)/(1-bases_lost_fastp_percent))-(metagenomic_bases+host_bases)) %&gt;% mutate(unmapped_bases = metagenomic_bases - mags_bases) %&gt;% mutate(unmapped_bases = ifelse(unmapped_bases &lt; 0, 0, unmapped_bases)) %&gt;% select(sample, lowqual_bases, host_bases, unmapped_bases, mags_bases, singlem_fraction) %&gt;% mutate(host_species=&quot;Podarcis geigae&quot;) sequence_fractions_pm &lt;- read_counts_pm %&gt;% pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;value&quot;) %&gt;% group_by(sample) %&gt;% summarise(mags = sum(value)) %&gt;% left_join(sample_metadata_pm, by = join_by(sample == sample)) %&gt;% select(sample,mags,metagenomic_bases,host_bases,bases_lost_fastp_percent, singlem_fraction) %&gt;% mutate(mags_bases = mags*146) %&gt;% mutate(lowqual_bases = ((metagenomic_bases+host_bases)/(1-bases_lost_fastp_percent))-(metagenomic_bases+host_bases)) %&gt;% mutate(unmapped_bases = metagenomic_bases - mags_bases) %&gt;% mutate(unmapped_bases = ifelse(unmapped_bases &lt; 0, 0, unmapped_bases)) %&gt;% select(sample, lowqual_bases, host_bases, unmapped_bases, mags_bases, singlem_fraction) %&gt;% mutate(host_species=&quot;Podarcis milensis&quot;) sequence_fractions_pp &lt;- read_counts_pp %&gt;% pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;value&quot;) %&gt;% group_by(sample) %&gt;% summarise(mags = sum(value)) %&gt;% left_join(sample_metadata_pp, by = join_by(sample == sample)) %&gt;% select(sample,mags,metagenomic_bases,host_bases,bases_lost_fastp_percent, singlem_fraction) %&gt;% mutate(mags_bases = mags*146) %&gt;% mutate(lowqual_bases = ((metagenomic_bases+host_bases)/(1-bases_lost_fastp_percent))-(metagenomic_bases+host_bases)) %&gt;% mutate(unmapped_bases = metagenomic_bases - mags_bases) %&gt;% mutate(unmapped_bases = ifelse(unmapped_bases &lt; 0, 0, unmapped_bases)) %&gt;% select(sample, lowqual_bases, host_bases, unmapped_bases, mags_bases, singlem_fraction) %&gt;% mutate(host_species=&quot;Podarcis pityusensis&quot;) sequence_fractions &lt;- bind_rows(sequence_fractions_pf,sequence_fractions_pg,sequence_fractions_pm,sequence_fractions_pp) sequence_fractions %&gt;% select(-singlem_fraction) %&gt;% pivot_longer(!c(sample,host_species), names_to = &quot;fraction&quot;, values_to = &quot;value&quot;) %&gt;% mutate(value = value / 1000000000) %&gt;% mutate(fraction = factor(fraction, levels = c(&quot;lowqual_bases&quot;,&quot;host_bases&quot;,&quot;unmapped_bases&quot;,&quot;mags_bases&quot;))) %&gt;% ggplot(., aes(x = sample, y = value, fill=fraction)) + geom_bar(position=&quot;stack&quot;, stat = &quot;identity&quot;) + scale_fill_manual(name=&quot;Sequence type&quot;, breaks=c(&quot;lowqual_bases&quot;,&quot;host_bases&quot;,&quot;unmapped_bases&quot;,&quot;mags_bases&quot;), labels=c(&quot;Low quality&quot;,&quot;Mapped to host&quot;,&quot;Unmapped&quot;,&quot;Mapped to MAGs&quot;), values=c(&quot;#CCCCCC&quot;, &quot;#bcdee1&quot;, &quot;#d8b8a3&quot;,&quot;#93655c&quot;))+ facet_wrap(~host_species, scales=&quot;free&quot;)+ labs(x = &quot;Samples&quot;, y = &quot;Amount of data (GB)&quot;) + theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size=6),legend.position = &quot;bottom&quot;) 3.3 Recovered microbial fraction 3.3.1 Per species DAMR visualisation based on individual MAG dereplications per species. singlem_table &lt;- sequence_fractions %&gt;% mutate(mags_proportion = round((mags_bases / (mags_bases + unmapped_bases))*100,2)) %&gt;% mutate(singlem_proportion = round(singlem_fraction*100,2)) %&gt;% select(sample,mags_proportion,singlem_proportion,host_species) %&gt;% mutate(mags_proportion = ifelse(singlem_proportion == 0, 0, mags_proportion)) %&gt;% #convert zeros to NA mutate(singlem_proportion = ifelse(singlem_proportion == 0, NA, singlem_proportion)) %&gt;% #convert zeros to NA mutate(singlem_proportion = ifelse(singlem_proportion &lt; mags_proportion, NA, singlem_proportion)) %&gt;% #if singlem is smaller, then NA, to simplify plot mutate(singlem_proportion = ifelse(singlem_proportion &gt; 100, 100, singlem_proportion)) #simplify singlem_table %&gt;% pivot_longer(!c(sample,host_species), names_to = &quot;proportion&quot;, values_to = &quot;value&quot;) %&gt;% mutate(proportion = factor(proportion, levels = c(&quot;mags_proportion&quot;,&quot;singlem_proportion&quot;))) %&gt;% ggplot(., aes(x = value, y = sample, color=proportion)) + geom_line(aes(group = sample), color = &quot;#f8a538&quot;) + geom_point() + scale_color_manual(name=&quot;Proportion&quot;, breaks=c(&quot;mags_proportion&quot;,&quot;singlem_proportion&quot;), labels=c(&quot;Recovered&quot;,&quot;Estimated&quot;), values=c(&quot;#52e1e8&quot;, &quot;#876b53&quot;))+ facet_nested(host_species ~ ., scales=&quot;free&quot;,space=&quot;free&quot;)+ theme_classic() + labs(y = &quot;Samples&quot;, x = &quot;Prokaryotic fraction (%)&quot;) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size=6), legend.position = &quot;right&quot;, strip.background.y=element_rect(color = NA, fill= &quot;#f4f4f4&quot;)) ### All DAMR visualisation after dereplicating MAGs from all 4 species. sequence_fractions_all&lt;- read_counts_all %&gt;% pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;value&quot;) %&gt;% group_by(sample) %&gt;% summarise(mags = sum(value)) %&gt;% left_join(sample_metadata_all, by = join_by(sample == sample)) %&gt;% select(sample,mags,metagenomic_bases,host_bases,bases_lost_fastp_percent, singlem_fraction) %&gt;% mutate(mags_bases = mags*146) %&gt;% mutate(lowqual_bases = ((metagenomic_bases+host_bases)/(1-bases_lost_fastp_percent))-(metagenomic_bases+host_bases)) %&gt;% mutate(unmapped_bases = metagenomic_bases - mags_bases) %&gt;% mutate(unmapped_bases = ifelse(unmapped_bases &lt; 0, 0, unmapped_bases)) %&gt;% select(sample, lowqual_bases, host_bases, unmapped_bases, mags_bases, singlem_fraction) singlem_table &lt;- sequence_fractions_all %&gt;% mutate(mags_proportion = round((mags_bases / (mags_bases + unmapped_bases))*100,2)) %&gt;% mutate(singlem_proportion = round(singlem_fraction,2)) %&gt;% select(sample,mags_proportion,singlem_proportion) %&gt;% mutate(mags_proportion = ifelse(singlem_proportion == 0, 0, mags_proportion)) %&gt;% #convert zeros to NA mutate(singlem_proportion = ifelse(singlem_proportion == 0, NA, singlem_proportion)) %&gt;% #convert zeros to NA mutate(singlem_proportion = ifelse(singlem_proportion &lt; mags_proportion, NA, singlem_proportion)) %&gt;% #if singlem is smaller, then NA, to simplify plot mutate(singlem_proportion = ifelse(singlem_proportion &gt; 100, 100, singlem_proportion)) #simplify singlem_table %&gt;% pivot_longer(!c(sample), names_to = &quot;proportion&quot;, values_to = &quot;value&quot;) %&gt;% mutate(proportion = factor(proportion, levels = c(&quot;mags_proportion&quot;,&quot;singlem_proportion&quot;))) %&gt;% ggplot(., aes(x = value, y = sample, color=proportion)) + geom_line(aes(group = sample), color = &quot;#f8a538&quot;) + geom_point() + scale_color_manual(name=&quot;Proportion&quot;, breaks=c(&quot;mags_proportion&quot;,&quot;singlem_proportion&quot;), labels=c(&quot;Recovered&quot;,&quot;Estimated&quot;), values=c(&quot;#52e1e8&quot;, &quot;#876b53&quot;))+ theme_classic() + labs(y = &quot;Samples&quot;, x = &quot;Prokaryotic fraction (%)&quot;) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size=6), legend.position = &quot;right&quot;, strip.background.y=element_rect(color = NA, fill= &quot;#f4f4f4&quot;)) "],["mag-catalogue.html", "Chapter 4 MAG catalogue 4.1 Genome phylogeny 4.2 Genome quality 4.3 Functional overview", " Chapter 4 MAG catalogue load(&quot;data/data_podarcis_filfolensis.Rdata&quot;) load(&quot;data/data_podarcis_gaigeae.Rdata&quot;) load(&quot;data/data_podarcis_milensis.Rdata&quot;) load(&quot;data/data_podarcis_pityusensis.Rdata&quot;) 4.1 Genome phylogeny 4.1.1 Podarcis filfolensis # Generate the phylum color heatmap phylum_heatmap &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata_pf, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree_pf$tip.label)) %&gt;% select(genome,phylum) %&gt;% mutate(phylum = factor(phylum, levels = unique(phylum))) %&gt;% column_to_rownames(var = &quot;genome&quot;) # Generate basal tree circular_tree &lt;- force.ultrametric(genome_tree_pf, method=&quot;extend&quot;) %&gt;% # extend to ultrametric for the sake of visualisation ggtree(., layout=&quot;fan&quot;, open.angle=10, size=0.5) *************************************************************** * Note: * * force.ultrametric does not include a formal method to * * ultrametricize a tree &amp; should only be used to coerce * * a phylogeny that fails is.ultrametric due to rounding -- * * not as a substitute for formal rate-smoothing methods. * *************************************************************** # Add phylum ring circular_tree &lt;- gheatmap(circular_tree, phylum_heatmap, offset=0.55, width=0.1, colnames=FALSE) + scale_fill_manual(values=phylum_colors_pf) + geom_tiplab2(size=1, hjust=-0.1) + theme(legend.position = &quot;none&quot;, plot.margin = margin(0, 0, 0, 0), panel.margin = margin(0, 0, 0, 0)) # Flush color scale to enable a new color scheme in the next ring circular_tree &lt;- circular_tree + new_scale_fill() # Add completeness ring circular_tree &lt;- circular_tree + new_scale_fill() + scale_fill_gradient(low = &quot;#d1f4ba&quot;, high = &quot;#f4baba&quot;) + geom_fruit( data=genome_metadata_pf, geom=geom_bar, mapping = aes(x=completeness, y=genome, fill=contamination), offset = 0.55, orientation=&quot;y&quot;, stat=&quot;identity&quot;) # Add genome-size ring circular_tree &lt;- circular_tree + new_scale_fill() + scale_fill_manual(values = &quot;#cccccc&quot;) + geom_fruit( data=genome_metadata_pf, geom=geom_bar, mapping = aes(x=length, y=genome), offset = 0.05, orientation=&quot;y&quot;, stat=&quot;identity&quot;) # Add text circular_tree &lt;- circular_tree + annotate(&#39;text&#39;, x=2.7, y=0, label=&#39; Phylum&#39;, family=&#39;arial&#39;, size=3.5) + annotate(&#39;text&#39;, x=3.1, y=0, label=&#39; Genome quality&#39;, family=&#39;arial&#39;, size=3.5) + annotate(&#39;text&#39;, x=3.5, y=0, label=&#39; Genome size&#39;, family=&#39;arial&#39;, size=3.5) #Plot circular tree circular_tree %&gt;% open_tree(30) %&gt;% rotate_tree(90) ### Podarcis geigae # Generate the phylum color heatmap phylum_heatmap &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata_pg, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree_pg$tip.label)) %&gt;% select(genome,phylum) %&gt;% mutate(phylum = factor(phylum, levels = unique(phylum))) %&gt;% column_to_rownames(var = &quot;genome&quot;) # Generate basal tree circular_tree &lt;- force.ultrametric(genome_tree_pg, method=&quot;extend&quot;) %&gt;% # extend to ultrametric for the sake of visualisation ggtree(., layout=&quot;fan&quot;, open.angle=10, size=0.5) *************************************************************** * Note: * * force.ultrametric does not include a formal method to * * ultrametricize a tree &amp; should only be used to coerce * * a phylogeny that fails is.ultrametric due to rounding -- * * not as a substitute for formal rate-smoothing methods. * *************************************************************** # Add phylum ring circular_tree &lt;- gheatmap(circular_tree, phylum_heatmap, offset=0.55, width=0.1, colnames=FALSE) + scale_fill_manual(values=phylum_colors_pg) + geom_tiplab2(size=1, hjust=-0.1) + theme(legend.position = &quot;none&quot;, plot.margin = margin(0, 0, 0, 0), panel.margin = margin(0, 0, 0, 0)) # Flush color scale to enable a new color scheme in the next ring circular_tree &lt;- circular_tree + new_scale_fill() # Add completeness ring circular_tree &lt;- circular_tree + new_scale_fill() + scale_fill_gradient(low = &quot;#d1f4ba&quot;, high = &quot;#f4baba&quot;) + geom_fruit( data=genome_metadata_pg, geom=geom_bar, mapping = aes(x=completeness, y=genome, fill=contamination), offset = 0.55, orientation=&quot;y&quot;, stat=&quot;identity&quot;) # Add genome-size ring circular_tree &lt;- circular_tree + new_scale_fill() + scale_fill_manual(values = &quot;#cccccc&quot;) + geom_fruit( data=genome_metadata_pg, geom=geom_bar, mapping = aes(x=length, y=genome), offset = 0.05, orientation=&quot;y&quot;, stat=&quot;identity&quot;) # Add text circular_tree &lt;- circular_tree + annotate(&#39;text&#39;, x=2.7, y=0, label=&#39; Phylum&#39;, family=&#39;arial&#39;, size=3.5) + annotate(&#39;text&#39;, x=3.1, y=0, label=&#39; Genome quality&#39;, family=&#39;arial&#39;, size=3.5) + annotate(&#39;text&#39;, x=3.5, y=0, label=&#39; Genome size&#39;, family=&#39;arial&#39;, size=3.5) #Plot circular tree circular_tree %&gt;% open_tree(30) %&gt;% rotate_tree(90) 4.1.2 Podarcis milensis # Generate the phylum color heatmap phylum_heatmap &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata_pm, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree_pm$tip.label)) %&gt;% select(genome,phylum) %&gt;% mutate(phylum = factor(phylum, levels = unique(phylum))) %&gt;% column_to_rownames(var = &quot;genome&quot;) # Generate basal tree circular_tree &lt;- force.ultrametric(genome_tree_pm, method=&quot;extend&quot;) %&gt;% # extend to ultrametric for the sake of visualisation ggtree(., layout=&quot;fan&quot;, open.angle=10, size=0.5) *************************************************************** * Note: * * force.ultrametric does not include a formal method to * * ultrametricize a tree &amp; should only be used to coerce * * a phylogeny that fails is.ultrametric due to rounding -- * * not as a substitute for formal rate-smoothing methods. * *************************************************************** # Add phylum ring circular_tree &lt;- gheatmap(circular_tree, phylum_heatmap, offset=0.55, width=0.1, colnames=FALSE) + scale_fill_manual(values=phylum_colors_pm) + geom_tiplab2(size=1, hjust=-0.1) + theme(legend.position = &quot;none&quot;, plot.margin = margin(0, 0, 0, 0), panel.margin = margin(0, 0, 0, 0)) # Flush color scale to enable a new color scheme in the next ring circular_tree &lt;- circular_tree + new_scale_fill() # Add completeness ring circular_tree &lt;- circular_tree + new_scale_fill() + scale_fill_gradient(low = &quot;#d1f4ba&quot;, high = &quot;#f4baba&quot;) + geom_fruit( data=genome_metadata_pm, geom=geom_bar, mapping = aes(x=completeness, y=genome, fill=contamination), offset = 0.55, orientation=&quot;y&quot;, stat=&quot;identity&quot;) # Add genome-size ring circular_tree &lt;- circular_tree + new_scale_fill() + scale_fill_manual(values = &quot;#cccccc&quot;) + geom_fruit( data=genome_metadata_pm, geom=geom_bar, mapping = aes(x=length, y=genome), offset = 0.05, orientation=&quot;y&quot;, stat=&quot;identity&quot;) # Add text circular_tree &lt;- circular_tree + annotate(&#39;text&#39;, x=2.7, y=0, label=&#39; Phylum&#39;, family=&#39;arial&#39;, size=3.5) + annotate(&#39;text&#39;, x=3.1, y=0, label=&#39; Genome quality&#39;, family=&#39;arial&#39;, size=3.5) + annotate(&#39;text&#39;, x=3.5, y=0, label=&#39; Genome size&#39;, family=&#39;arial&#39;, size=3.5) #Plot circular tree circular_tree %&gt;% open_tree(30) %&gt;% rotate_tree(90) 4.1.3 Podarcis pityusensis # Generate the phylum color heatmap phylum_heatmap &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata_pp, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree_pp$tip.label)) %&gt;% select(genome,phylum) %&gt;% mutate(phylum = factor(phylum, levels = unique(phylum))) %&gt;% column_to_rownames(var = &quot;genome&quot;) # Generate basal tree circular_tree &lt;- force.ultrametric(genome_tree_pp, method=&quot;extend&quot;) %&gt;% # extend to ultrametric for the sake of visualisation ggtree(., layout=&quot;fan&quot;, open.angle=10, size=0.5) *************************************************************** * Note: * * force.ultrametric does not include a formal method to * * ultrametricize a tree &amp; should only be used to coerce * * a phylogeny that fails is.ultrametric due to rounding -- * * not as a substitute for formal rate-smoothing methods. * *************************************************************** # Add phylum ring circular_tree &lt;- gheatmap(circular_tree, phylum_heatmap, offset=0.55, width=0.1, colnames=FALSE) + scale_fill_manual(values=phylum_colors_pp) + geom_tiplab2(size=1, hjust=-0.1) + theme(legend.position = &quot;none&quot;, plot.margin = margin(0, 0, 0, 0), panel.margin = margin(0, 0, 0, 0)) # Flush color scale to enable a new color scheme in the next ring circular_tree &lt;- circular_tree + new_scale_fill() # Add completeness ring circular_tree &lt;- circular_tree + new_scale_fill() + scale_fill_gradient(low = &quot;#d1f4ba&quot;, high = &quot;#f4baba&quot;) + geom_fruit( data=genome_metadata_pp, geom=geom_bar, mapping = aes(x=completeness, y=genome, fill=contamination), offset = 0.55, orientation=&quot;y&quot;, stat=&quot;identity&quot;) # Add genome-size ring circular_tree &lt;- circular_tree + new_scale_fill() + scale_fill_manual(values = &quot;#cccccc&quot;) + geom_fruit( data=genome_metadata_pp, geom=geom_bar, mapping = aes(x=length, y=genome), offset = 0.05, orientation=&quot;y&quot;, stat=&quot;identity&quot;) # Add text circular_tree &lt;- circular_tree + annotate(&#39;text&#39;, x=2.7, y=0, label=&#39; Phylum&#39;, family=&#39;arial&#39;, size=3.5) + annotate(&#39;text&#39;, x=3.1, y=0, label=&#39; Genome quality&#39;, family=&#39;arial&#39;, size=3.5) + annotate(&#39;text&#39;, x=3.5, y=0, label=&#39; Genome size&#39;, family=&#39;arial&#39;, size=3.5) #Plot circular tree circular_tree %&gt;% open_tree(30) %&gt;% rotate_tree(90) 4.2 Genome quality bind_rows(list(genome_metadata_pf %&gt;% mutate(host_species=&quot;Podarcis filfolensis&quot;), genome_metadata_pg %&gt;% mutate(host_species=&quot;Podarcis geigae&quot;), genome_metadata_pm %&gt;% mutate(host_species=&quot;Podarcis milensis&quot;), genome_metadata_pp %&gt;% mutate(host_species=&quot;Podarcis pityusensis&quot;))) %&gt;% group_by(host_species) %&gt;% summarise(completeness_mean=mean(completeness) %&gt;% round(2) %&gt;% as.character(), completeness_sd=sd(completeness) %&gt;% round(2) %&gt;% as.character(), contamination_mean=mean(contamination) %&gt;% round(2), contamination_sd=sd(contamination) %&gt;% round(2)) %&gt;% unite(&quot;Completeness&quot;,completeness_mean, completeness_sd, sep = &quot; ± &quot;, remove = TRUE) %&gt;% unite(&quot;Contamination&quot;,contamination_mean, contamination_sd, sep = &quot; ± &quot;, remove = TRUE) %&gt;% tt() tinytable_4v1wu1huy2519wzmlo4y .table td.tinytable_css_n8hozo8ez4albzcni6k6, .table th.tinytable_css_n8hozo8ez4albzcni6k6 { border-bottom: solid 0.1em #d3d8dc; } host_species Completeness Contamination Podarcis filfolensis 82.75 ± 16.25 1.89 ± 2.1 Podarcis geigae 82.93 ± 15.99 1.99 ± 2.22 Podarcis milensis 81.27 ± 16.43 2.05 ± 2.25 Podarcis pityusensis 85.86 ± 14.69 1.7 ± 1.99 4.2.1 Podarcis filfolensis #Generate quality biplot genome_biplot &lt;- genome_metadata_pf %&gt;% select(c(genome,domain,phylum,completeness,contamination,length)) %&gt;% arrange(match(genome, rev(genome_tree_pf$tip.label))) %&gt;% #sort MAGs according to phylogenetic tree ggplot(aes(x=completeness,y=contamination,size=length,color=phylum)) + geom_point(alpha=0.7) + ylim(c(10,0)) + scale_color_manual(values=phylum_colors_pf) + labs(y= &quot;Contamination&quot;, x = &quot;Completeness&quot;) + theme_classic() + theme(legend.position = &quot;none&quot;) #Generate contamination boxplot genome_contamination &lt;- genome_metadata_pf %&gt;% ggplot(aes(y=contamination)) + ylim(c(10,0)) + geom_boxplot(colour = &quot;#999999&quot;, fill=&quot;#cccccc&quot;) + theme_void() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(), plot.margin = unit(c(0, 0, 0.40, 0),&quot;inches&quot;)) #add bottom-margin (top, right, bottom, left) #Generate completeness boxplot genome_completeness &lt;- genome_metadata_pf %&gt;% ggplot(aes(x=completeness)) + xlim(c(50,100)) + geom_boxplot(colour = &quot;#999999&quot;, fill=&quot;#cccccc&quot;) + theme_void() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(), plot.margin = unit(c(0, 0, 0, 0.50),&quot;inches&quot;)) #add left-margin (top, right, bottom, left) #Render composite figure grid.arrange(grobs = list(genome_completeness,genome_biplot,genome_contamination), layout_matrix = rbind(c(1,1,1,1,1,1,1,1,1,1,1,4), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3))) 4.2.2 Podarcis geigae #Generate quality biplot genome_biplot &lt;- genome_metadata_pg %&gt;% select(c(genome,domain,phylum,completeness,contamination,length)) %&gt;% arrange(match(genome, rev(genome_tree_pg$tip.label))) %&gt;% #sort MAGs according to phylogenetic tree ggplot(aes(x=completeness,y=contamination,size=length,color=phylum)) + geom_point(alpha=0.7) + ylim(c(10,0)) + scale_color_manual(values=phylum_colors_pg) + labs(y= &quot;Contamination&quot;, x = &quot;Completeness&quot;) + theme_classic() + theme(legend.position = &quot;none&quot;) #Generate contamination boxplot genome_contamination &lt;- genome_metadata_pg %&gt;% ggplot(aes(y=contamination)) + ylim(c(10,0)) + geom_boxplot(colour = &quot;#999999&quot;, fill=&quot;#cccccc&quot;) + theme_void() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(), plot.margin = unit(c(0, 0, 0.40, 0),&quot;inches&quot;)) #add bottom-margin (top, right, bottom, left) #Generate completeness boxplot genome_completeness &lt;- genome_metadata_pg %&gt;% ggplot(aes(x=completeness)) + xlim(c(50,100)) + geom_boxplot(colour = &quot;#999999&quot;, fill=&quot;#cccccc&quot;) + theme_void() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(), plot.margin = unit(c(0, 0, 0, 0.50),&quot;inches&quot;)) #add left-margin (top, right, bottom, left) #Render composite figure grid.arrange(grobs = list(genome_completeness,genome_biplot,genome_contamination), layout_matrix = rbind(c(1,1,1,1,1,1,1,1,1,1,1,4), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3))) 4.2.3 Podarcis milensis #Generate quality biplot genome_biplot &lt;- genome_metadata_pm %&gt;% select(c(genome,domain,phylum,completeness,contamination,length)) %&gt;% arrange(match(genome, rev(genome_tree_pm$tip.label))) %&gt;% #sort MAGs according to phylogenetic tree ggplot(aes(x=completeness,y=contamination,size=length,color=phylum)) + geom_point(alpha=0.7) + ylim(c(10,0)) + scale_color_manual(values=phylum_colors_pm) + labs(y= &quot;Contamination&quot;, x = &quot;Completeness&quot;) + theme_classic() + theme(legend.position = &quot;none&quot;) #Generate contamination boxplot genome_contamination &lt;- genome_metadata_pm %&gt;% ggplot(aes(y=contamination)) + ylim(c(10,0)) + geom_boxplot(colour = &quot;#999999&quot;, fill=&quot;#cccccc&quot;) + theme_void() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(), plot.margin = unit(c(0, 0, 0.40, 0),&quot;inches&quot;)) #add bottom-margin (top, right, bottom, left) #Generate completeness boxplot genome_completeness &lt;- genome_metadata_pm %&gt;% ggplot(aes(x=completeness)) + xlim(c(50,100)) + geom_boxplot(colour = &quot;#999999&quot;, fill=&quot;#cccccc&quot;) + theme_void() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(), plot.margin = unit(c(0, 0, 0, 0.50),&quot;inches&quot;)) #add left-margin (top, right, bottom, left) #Render composite figure grid.arrange(grobs = list(genome_completeness,genome_biplot,genome_contamination), layout_matrix = rbind(c(1,1,1,1,1,1,1,1,1,1,1,4), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3))) 4.2.4 Podarcis pityusensis #Generate quality biplot genome_biplot &lt;- genome_metadata_pp %&gt;% select(c(genome,domain,phylum,completeness,contamination,length)) %&gt;% arrange(match(genome, rev(genome_tree_pp$tip.label))) %&gt;% #sort MAGs according to phylogenetic tree ggplot(aes(x=completeness,y=contamination,size=length,color=phylum)) + geom_point(alpha=0.7) + ylim(c(10,0)) + scale_color_manual(values=phylum_colors_pp) + labs(y= &quot;Contamination&quot;, x = &quot;Completeness&quot;) + theme_classic() + theme(legend.position = &quot;none&quot;) #Generate contamination boxplot genome_contamination &lt;- genome_metadata_pp %&gt;% ggplot(aes(y=contamination)) + ylim(c(10,0)) + geom_boxplot(colour = &quot;#999999&quot;, fill=&quot;#cccccc&quot;) + theme_void() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(), plot.margin = unit(c(0, 0, 0.40, 0),&quot;inches&quot;)) #add bottom-margin (top, right, bottom, left) #Generate completeness boxplot genome_completeness &lt;- genome_metadata_pp %&gt;% ggplot(aes(x=completeness)) + xlim(c(50,100)) + geom_boxplot(colour = &quot;#999999&quot;, fill=&quot;#cccccc&quot;) + theme_void() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.y=element_blank(), axis.ticks.y=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank(), plot.margin = unit(c(0, 0, 0, 0.50),&quot;inches&quot;)) #add left-margin (top, right, bottom, left) #Render composite figure grid.arrange(grobs = list(genome_completeness,genome_biplot,genome_contamination), layout_matrix = rbind(c(1,1,1,1,1,1,1,1,1,1,1,4), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3), c(2,2,2,2,2,2,2,2,2,2,2,3))) 4.3 Functional overview 4.3.1 Podarcis filfolensis phylum_heatmap &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata_pp, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree_pp$tip.label)) %&gt;% select(genome,phylum) %&gt;% mutate(phylum = factor(phylum, levels = unique(phylum))) %&gt;% column_to_rownames(var = &quot;genome&quot;) # Aggregate basal GIFT into elements function_table &lt;- genome_gifts_pf %&gt;% to.elements(., GIFT_db) # Generate basal tree function_tree &lt;- force.ultrametric(genome_tree_pf, method=&quot;extend&quot;) %&gt;% ggtree(., size = 0.3) *************************************************************** * Note: * * force.ultrametric does not include a formal method to * * ultrametricize a tree &amp; should only be used to coerce * * a phylogeny that fails is.ultrametric due to rounding -- * * not as a substitute for formal rate-smoothing methods. * *************************************************************** #Add phylum colors next to the tree tips function_tree &lt;- gheatmap(function_tree, phylum_heatmap, offset=0, width=0.1, colnames=FALSE) + scale_fill_manual(values=phylum_colors_pf) + labs(fill=&quot;Phylum&quot;) #Reset fill scale to use a different colour profile in the heatmap function_tree &lt;- function_tree + new_scale_fill() #Add functions heatmap function_tree &lt;- gheatmap(function_tree, function_table, offset=0.5, width=3.5, colnames=FALSE) + vexpand(.08) + coord_cartesian(clip = &quot;off&quot;) + scale_fill_gradient(low = &quot;#f4f4f4&quot;, high = &quot;steelblue&quot;, na.value=&quot;white&quot;) + labs(fill=&quot;GIFT&quot;) #Reset fill scale to use a different colour profile in the heatmap function_tree &lt;- function_tree + new_scale_fill() # Add completeness barplots function_tree &lt;- function_tree + geom_fruit(data=genome_metadata_pf, geom=geom_bar, grid.params=list(axis=&quot;x&quot;, text.size=2, nbreak = 1), axis.params=list(vline=TRUE), mapping = aes(x=length, y=genome, fill=completeness), offset = 3.8, orientation=&quot;y&quot;, stat=&quot;identity&quot;) + scale_fill_gradient(low = &quot;#cf8888&quot;, high = &quot;#a2cc87&quot;) + labs(fill=&quot;Genome\\ncompleteness&quot;) function_tree set.seed(101) # Generate the tSNE ordination tSNE_function &lt;- Rtsne(X=function_table, dims = 2, check_duplicates = FALSE) # Plot the ordination function_ordination &lt;- tSNE_function$Y %&gt;% as.data.frame() %&gt;% mutate(genome=rownames(function_table)) %&gt;% inner_join(genome_metadata_pf, by=&quot;genome&quot;) %&gt;% rename(tSNE1=&quot;V1&quot;, tSNE2=&quot;V2&quot;) %&gt;% select(genome,phylum,tSNE1,tSNE2, length) %&gt;% ggplot(aes(x = tSNE1, y = tSNE2, color = phylum, size=length))+ geom_point(shape=16, alpha=0.7) + scale_color_manual(values=phylum_colors_pf) + theme_minimal() + labs(color=&quot;Phylum&quot;, size=&quot;Genome size&quot;) + guides(color = guide_legend(override.aes = list(size = 5))) # enlarge Phylum dots in legend function_ordination 4.3.2 Podarcis geigae phylum_heatmap &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata_pp, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree_pp$tip.label)) %&gt;% select(genome,phylum) %&gt;% mutate(phylum = factor(phylum, levels = unique(phylum))) %&gt;% column_to_rownames(var = &quot;genome&quot;) # Aggregate basal GIFT into elements function_table &lt;- genome_gifts_pg %&gt;% to.elements(., GIFT_db) # Generate basal tree function_tree &lt;- force.ultrametric(genome_tree_pg, method=&quot;extend&quot;) %&gt;% ggtree(., size = 0.3) *************************************************************** * Note: * * force.ultrametric does not include a formal method to * * ultrametricize a tree &amp; should only be used to coerce * * a phylogeny that fails is.ultrametric due to rounding -- * * not as a substitute for formal rate-smoothing methods. * *************************************************************** #Add phylum colors next to the tree tips function_tree &lt;- gheatmap(function_tree, phylum_heatmap, offset=0, width=0.1, colnames=FALSE) + scale_fill_manual(values=phylum_colors_pg) + labs(fill=&quot;Phylum&quot;) #Reset fill scale to use a different colour profile in the heatmap function_tree &lt;- function_tree + new_scale_fill() #Add functions heatmap function_tree &lt;- gheatmap(function_tree, function_table, offset=0.5, width=3.5, colnames=FALSE) + vexpand(.08) + coord_cartesian(clip = &quot;off&quot;) + scale_fill_gradient(low = &quot;#f4f4f4&quot;, high = &quot;steelblue&quot;, na.value=&quot;white&quot;) + labs(fill=&quot;GIFT&quot;) #Reset fill scale to use a different colour profile in the heatmap function_tree &lt;- function_tree + new_scale_fill() # Add completeness barplots function_tree &lt;- function_tree + geom_fruit(data=genome_metadata_pg, geom=geom_bar, grid.params=list(axis=&quot;x&quot;, text.size=2, nbreak = 1), axis.params=list(vline=TRUE), mapping = aes(x=length, y=genome, fill=completeness), offset = 3.8, orientation=&quot;y&quot;, stat=&quot;identity&quot;) + scale_fill_gradient(low = &quot;#cf8888&quot;, high = &quot;#a2cc87&quot;) + labs(fill=&quot;Genome\\ncompleteness&quot;) function_tree set.seed(101) # Generate the tSNE ordination tSNE_function &lt;- Rtsne(X=function_table, dims = 2, check_duplicates = FALSE) # Plot the ordination function_ordination &lt;- tSNE_function$Y %&gt;% as.data.frame() %&gt;% mutate(genome=rownames(function_table)) %&gt;% inner_join(genome_metadata_pg, by=&quot;genome&quot;) %&gt;% rename(tSNE1=&quot;V1&quot;, tSNE2=&quot;V2&quot;) %&gt;% select(genome,phylum,tSNE1,tSNE2, length) %&gt;% ggplot(aes(x = tSNE1, y = tSNE2, color = phylum, size=length))+ geom_point(shape=16, alpha=0.7) + scale_color_manual(values=phylum_colors_pg) + theme_minimal() + labs(color=&quot;Phylum&quot;, size=&quot;Genome size&quot;) + guides(color = guide_legend(override.aes = list(size = 5))) # enlarge Phylum dots in legend function_ordination 4.3.3 Podarcis milensis phylum_heatmap &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata_pp, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree_pp$tip.label)) %&gt;% select(genome,phylum) %&gt;% mutate(phylum = factor(phylum, levels = unique(phylum))) %&gt;% column_to_rownames(var = &quot;genome&quot;) # Aggregate basal GIFT into elements function_table &lt;- genome_gifts_pm %&gt;% to.elements(., GIFT_db) # Generate basal tree function_tree &lt;- force.ultrametric(genome_tree_pm, method=&quot;extend&quot;) %&gt;% ggtree(., size = 0.3) *************************************************************** * Note: * * force.ultrametric does not include a formal method to * * ultrametricize a tree &amp; should only be used to coerce * * a phylogeny that fails is.ultrametric due to rounding -- * * not as a substitute for formal rate-smoothing methods. * *************************************************************** #Add phylum colors next to the tree tips function_tree &lt;- gheatmap(function_tree, phylum_heatmap, offset=0, width=0.1, colnames=FALSE) + scale_fill_manual(values=phylum_colors_pm) + labs(fill=&quot;Phylum&quot;) #Reset fill scale to use a different colour profile in the heatmap function_tree &lt;- function_tree + new_scale_fill() #Add functions heatmap function_tree &lt;- gheatmap(function_tree, function_table, offset=0.5, width=3.5, colnames=FALSE) + vexpand(.08) + coord_cartesian(clip = &quot;off&quot;) + scale_fill_gradient(low = &quot;#f4f4f4&quot;, high = &quot;steelblue&quot;, na.value=&quot;white&quot;) + labs(fill=&quot;GIFT&quot;) #Reset fill scale to use a different colour profile in the heatmap function_tree &lt;- function_tree + new_scale_fill() # Add completeness barplots function_tree &lt;- function_tree + geom_fruit(data=genome_metadata_pm, geom=geom_bar, grid.params=list(axis=&quot;x&quot;, text.size=2, nbreak = 1), axis.params=list(vline=TRUE), mapping = aes(x=length, y=genome, fill=completeness), offset = 3.8, orientation=&quot;y&quot;, stat=&quot;identity&quot;) + scale_fill_gradient(low = &quot;#cf8888&quot;, high = &quot;#a2cc87&quot;) + labs(fill=&quot;Genome\\ncompleteness&quot;) function_tree set.seed(101) # Generate the tSNE ordination tSNE_function &lt;- Rtsne(X=function_table, dims = 2, check_duplicates = FALSE) # Plot the ordination function_ordination &lt;- tSNE_function$Y %&gt;% as.data.frame() %&gt;% mutate(genome=rownames(function_table)) %&gt;% inner_join(genome_metadata_pm, by=&quot;genome&quot;) %&gt;% rename(tSNE1=&quot;V1&quot;, tSNE2=&quot;V2&quot;) %&gt;% select(genome,phylum,tSNE1,tSNE2, length) %&gt;% ggplot(aes(x = tSNE1, y = tSNE2, color = phylum, size=length))+ geom_point(shape=16, alpha=0.7) + scale_color_manual(values=phylum_colors_pm) + theme_minimal() + labs(color=&quot;Phylum&quot;, size=&quot;Genome size&quot;) + guides(color = guide_legend(override.aes = list(size = 5))) # enlarge Phylum dots in legend function_ordination 4.3.4 Podarcis pityusensis phylum_heatmap &lt;- read_tsv(&quot;https://raw.githubusercontent.com/earthhologenome/EHI_taxonomy_colour/main/ehi_phylum_colors.tsv&quot;) %&gt;% right_join(genome_metadata_pp, by=join_by(phylum == phylum)) %&gt;% arrange(match(genome, genome_tree_pp$tip.label)) %&gt;% select(genome,phylum) %&gt;% mutate(phylum = factor(phylum, levels = unique(phylum))) %&gt;% column_to_rownames(var = &quot;genome&quot;) # Aggregate basal GIFT into elements function_table &lt;- genome_gifts_pp %&gt;% to.elements(., GIFT_db) # Generate basal tree function_tree &lt;- force.ultrametric(genome_tree_pp, method=&quot;extend&quot;) %&gt;% ggtree(., size = 0.3) *************************************************************** * Note: * * force.ultrametric does not include a formal method to * * ultrametricize a tree &amp; should only be used to coerce * * a phylogeny that fails is.ultrametric due to rounding -- * * not as a substitute for formal rate-smoothing methods. * *************************************************************** #Add phylum colors next to the tree tips function_tree &lt;- gheatmap(function_tree, phylum_heatmap, offset=0, width=0.1, colnames=FALSE) + scale_fill_manual(values=phylum_colors_pp) + labs(fill=&quot;Phylum&quot;) #Reset fill scale to use a different colour profile in the heatmap function_tree &lt;- function_tree + new_scale_fill() #Add functions heatmap function_tree &lt;- gheatmap(function_tree, function_table, offset=0.5, width=3.5, colnames=FALSE) + vexpand(.08) + coord_cartesian(clip = &quot;off&quot;) + scale_fill_gradient(low = &quot;#f4f4f4&quot;, high = &quot;steelblue&quot;, na.value=&quot;white&quot;) + labs(fill=&quot;GIFT&quot;) #Reset fill scale to use a different colour profile in the heatmap function_tree &lt;- function_tree + new_scale_fill() # Add completeness barplots function_tree &lt;- function_tree + geom_fruit(data=genome_metadata_pp, geom=geom_bar, grid.params=list(axis=&quot;x&quot;, text.size=2, nbreak = 1), axis.params=list(vline=TRUE), mapping = aes(x=length, y=genome, fill=completeness), offset = 3.8, orientation=&quot;y&quot;, stat=&quot;identity&quot;) + scale_fill_gradient(low = &quot;#cf8888&quot;, high = &quot;#a2cc87&quot;) + labs(fill=&quot;Genome\\ncompleteness&quot;) function_tree set.seed(101) # Generate the tSNE ordination tSNE_function &lt;- Rtsne(X=function_table, dims = 2, check_duplicates = FALSE) # Plot the ordination function_ordination &lt;- tSNE_function$Y %&gt;% as.data.frame() %&gt;% mutate(genome=rownames(function_table)) %&gt;% inner_join(genome_metadata_pp, by=&quot;genome&quot;) %&gt;% rename(tSNE1=&quot;V1&quot;, tSNE2=&quot;V2&quot;) %&gt;% select(genome,phylum,tSNE1,tSNE2, length) %&gt;% ggplot(aes(x = tSNE1, y = tSNE2, color = phylum, size=length))+ geom_point(shape=16, alpha=0.7) + scale_color_manual(values=phylum_colors_pp) + theme_minimal() + labs(color=&quot;Phylum&quot;, size=&quot;Genome size&quot;) + guides(color = guide_legend(override.aes = list(size = 5))) # enlarge Phylum dots in legend function_ordination "],["compositional-analysis.html", "Chapter 5 Compositional analysis 5.1 Taxonomy barplots 5.2 Taxonomic representation 5.3 Compositional dissimilarities", " Chapter 5 Compositional analysis load(&quot;data/data_podarcis_filfolensis.Rdata&quot;) load(&quot;data/data_podarcis_gaigeae.Rdata&quot;) load(&quot;data/data_podarcis_milensis.Rdata&quot;) load(&quot;data/data_podarcis_pityusensis.Rdata&quot;) load(&quot;data/data_podarcis_all.Rdata&quot;) 5.1 Taxonomy barplots 5.1.1 Podarcis filfolensis genome_counts_filt_pf %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% #reduce to minimum number of columns left_join(., genome_metadata_pf, by = join_by(genome == genome)) %&gt;% #append genome metadata left_join(., sample_metadata_pf, by = join_by(sample == sample)) %&gt;% #append sample metadata filter(!is.na(count)) %&gt;% ggplot(aes(y=count,x=sample, fill=phylum, group=phylum)) + #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1) + #plot stacked bars with white borders scale_fill_manual(values=phylum_colors_pf) + labs(x = &quot;Relative abundance&quot;, y =&quot;Samples&quot;) + facet_nested(. ~ population, scales=&quot;free&quot;, space=&quot;free&quot;) + #facet per day and treatment scale_y_continuous(expand = c(0.001, 0.001)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position = &quot;none&quot;, strip.background.x=element_rect(color = NA, fill= &quot;#f4f4f4&quot;)) genome_counts_filt_pg %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% #reduce to minimum number of columns left_join(., genome_metadata_pg, by = join_by(genome == genome)) %&gt;% #append genome metadata left_join(., sample_metadata_pg, by = join_by(sample == sample)) %&gt;% #append sample metadata filter(!is.na(count)) %&gt;% ggplot(aes(y=count,x=sample, fill=phylum, group=phylum)) + #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1) + #plot stacked bars with white borders scale_fill_manual(values=phylum_colors_pg) + labs(x = &quot;Relative abundance&quot;, y =&quot;Samples&quot;) + facet_nested(. ~ population, scales=&quot;free&quot;, space=&quot;free&quot;) + #facet per day and treatment scale_y_continuous(expand = c(0.001, 0.001)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position = &quot;none&quot;, strip.background.x=element_rect(color = NA, fill= &quot;#f4f4f4&quot;)) genome_counts_filt_pm %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% #reduce to minimum number of columns left_join(., genome_metadata_pm, by = join_by(genome == genome)) %&gt;% #append genome metadata left_join(., sample_metadata_pm, by = join_by(sample == sample)) %&gt;% #append sample metadata filter(!is.na(count)) %&gt;% ggplot(aes(y=count,x=sample, fill=phylum, group=phylum)) + #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1) + #plot stacked bars with white borders scale_fill_manual(values=phylum_colors_pm) + labs(x = &quot;Relative abundance&quot;, y =&quot;Samples&quot;) + facet_nested(. ~ population, scales=&quot;free&quot;, space=&quot;free&quot;) + #facet per day and treatment scale_y_continuous(expand = c(0.001, 0.001)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position = &quot;none&quot;, strip.background.x=element_rect(color = NA, fill= &quot;#f4f4f4&quot;)) genome_counts_filt_pp %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% #reduce to minimum number of columns left_join(., genome_metadata_pp, by = join_by(genome == genome)) %&gt;% #append genome metadata left_join(., sample_metadata_pp, by = join_by(sample == sample)) %&gt;% #append sample metadata filter(!is.na(count)) %&gt;% ggplot(aes(y=count,x=sample, fill=phylum, group=phylum)) + #grouping enables keeping the same sorting of taxonomic units geom_bar(stat=&quot;identity&quot;, colour=&quot;white&quot;, linewidth=0.1) + #plot stacked bars with white borders scale_fill_manual(values=phylum_colors_pp) + labs(x = &quot;Relative abundance&quot;, y =&quot;Samples&quot;) + facet_nested(. ~ population, scales=&quot;free&quot;, space=&quot;free&quot;) + #facet per day and treatment scale_y_continuous(expand = c(0.001, 0.001)) + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), axis.title.x = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(linewidth = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.position = &quot;none&quot;, strip.background.x=element_rect(color = NA, fill= &quot;#f4f4f4&quot;)) 5.2 Taxonomic representation 5.2.1 Phylum phylum_summary &lt;- genome_counts_filt_all %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% #reduce to minimum number of columns left_join(sample_metadata_all, by = join_by(sample == sample)) %&gt;% #append sample metadata left_join(genome_metadata_all, by = join_by(genome == genome)) %&gt;% #append genome metadata group_by(sample,phylum) %&gt;% summarise(relabun=sum(count)) phylum_summary %&gt;% filter(!is.na(relabun)) %&gt;% group_by(phylum) %&gt;% summarise(mean=mean(relabun),sd=sd(relabun)) %&gt;% mutate(phylum= sub(&quot;^p__&quot;, &quot;&quot;, phylum)) %&gt;% arrange(-mean) %&gt;% tt() tinytable_d8qbcf82apjm1qtqfxiz .table td.tinytable_css_ezpcnl9e7qubk4d163c7, .table th.tinytable_css_ezpcnl9e7qubk4d163c7 { border-bottom: solid 0.1em #d3d8dc; } phylum mean sd Bacillota_A 4.355073e-01 0.1637303694 Bacteroidota 3.795311e-01 0.1493442024 Bacillota 6.693929e-02 0.0613238855 Pseudomonadota 4.237993e-02 0.0659965403 Desulfobacterota 1.762937e-02 0.0168493333 Campylobacterota 1.394838e-02 0.0229133933 Cyanobacteriota 8.474584e-03 0.0120549930 Verrucomicrobiota 8.226209e-03 0.0140684507 Bacillota_C 6.505350e-03 0.0077147585 Spirochaetota 5.445050e-03 0.0249843346 Bacillota_B 4.111308e-03 0.0057340543 Fusobacteriota 3.024136e-03 0.0134489815 Halobacteriota 2.947999e-03 0.0105666272 Actinomycetota 2.221294e-03 0.0190806008 Chlamydiota 1.109162e-03 0.0112564276 Elusimicrobiota 1.104802e-03 0.0036746035 Synergistota 3.666072e-04 0.0024311729 Planctomycetota 1.908305e-04 0.0017144286 1.473864e-04 0.0009299590 Deferribacterota 1.413909e-04 0.0006340007 Thermoplasmatota 4.851518e-05 0.0006362706 phylum_arrange &lt;- phylum_summary %&gt;% filter(!is.na(relabun)) %&gt;% group_by(phylum) %&gt;% summarise(mean=sum(relabun)) %&gt;% arrange(-mean) %&gt;% select(phylum) %&gt;% #mutate(phylum= sub(&quot;^p__&quot;, &quot;&quot;, phylum)) %&gt;% pull() phylum_summary %&gt;% left_join(genome_metadata_all %&gt;% select(phylum) %&gt;% unique(),by=&quot;phylum&quot;) %&gt;% left_join(sample_metadata_all,by=join_by(sample==sample)) %&gt;% filter(phylum != &quot;p__&quot;) %&gt;% #mutate(phylum= sub(&quot;^p__&quot;, &quot;&quot;, phylum)) %&gt;% filter(phylum %in% phylum_arrange[1:20]) %&gt;% mutate(phylum=factor(phylum,levels=rev(phylum_arrange[1:20]))) %&gt;% filter(relabun &gt; 0) %&gt;% ggplot(aes(x=relabun, y=phylum, group=phylum, color=phylum, fill=phylum)) + scale_color_manual(values=phylum_colors_all) + scale_fill_manual(values=phylum_colors_all) + geom_jitter(alpha=0.5) + facet_nested(. ~ species)+ theme_minimal() + theme(legend.position = &quot;none&quot;) 5.2.2 Order order_summary &lt;- genome_counts_filt_all %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% #reduce to minimum number of columns left_join(sample_metadata_all %&gt;% rename(host_order=order), by = join_by(sample == sample)) %&gt;% #append sample metadata left_join(genome_metadata_all, by = join_by(genome == genome)) %&gt;% #append genome metadata group_by(sample,order) %&gt;% summarise(relabun=sum(count)) order_summary %&gt;% filter(!is.na(relabun)) %&gt;% group_by(order) %&gt;% summarise(mean=mean(relabun),sd=sd(relabun)) %&gt;% mutate(famorderily= sub(&quot;^o__&quot;, &quot;&quot;, order)) %&gt;% arrange(-mean) %&gt;% tt() tinytable_iktl1ieudseb8mj2xjnw .table td.tinytable_css_84odcyznwtvxz2m8yxws, .table th.tinytable_css_84odcyznwtvxz2m8yxws { border-bottom: solid 0.1em #d3d8dc; } order mean sd famorderily o__Bacteroidales 3.795311e-01 0.1493442024 Bacteroidales o__Lachnospirales 2.817732e-01 0.1573578010 Lachnospirales o__Oscillospirales 7.730821e-02 0.0482442135 Oscillospirales o__Christensenellales 6.152228e-02 0.0521531204 Christensenellales o__Erysipelotrichales 3.205759e-02 0.0472082321 Erysipelotrichales o__Desulfovibrionales 1.762937e-02 0.0168493333 Desulfovibrionales o__Enterobacterales 1.596443e-02 0.0397310018 Enterobacterales o__Campylobacterales 1.394838e-02 0.0229133933 Campylobacterales o__Mycoplasmatales 9.674457e-03 0.0201025198 Mycoplasmatales o__Acholeplasmatales 9.244018e-03 0.0156078657 Acholeplasmatales o__Gastranaerophilales 8.474584e-03 0.0120549930 Gastranaerophilales o__RF32 7.907507e-03 0.0109564629 RF32 o__RF39 7.616380e-03 0.0129867266 RF39 o__Verrucomicrobiales 7.557137e-03 0.0136890242 Verrucomicrobiales o__Enterobacterales_A 6.146616e-03 0.0225932402 Enterobacterales_A o__RFN20 5.491908e-03 0.0134551586 RFN20 o__TANB77 5.387227e-03 0.0091071005 TANB77 o__Peptostreptococcales 4.806343e-03 0.0075471530 Peptostreptococcales o__UBA3830 4.368400e-03 0.0098939122 UBA3830 o__Clostridiales 4.071744e-03 0.0181994301 Clostridiales o__Selenomonadales 3.953551e-03 0.0066974902 Selenomonadales o__Peptococcales 3.689298e-03 0.0055754286 Peptococcales o__Sphaerochaetales 3.529054e-03 0.0216011752 Sphaerochaetales o__Diplorickettsiales 3.505108e-03 0.0459055178 Diplorickettsiales o__Fusobacteriales 3.024136e-03 0.0134489815 Fusobacteriales o__Acidaminococcales 2.551799e-03 0.0049055131 Acidaminococcales o__Methanosarcinales 2.372541e-03 0.0097274543 Methanosarcinales o__RUG11792 2.184233e-03 0.0053494956 RUG11792 o__Actinomycetales 1.561179e-03 0.0190765399 Actinomycetales o__Lactobacillales 1.265853e-03 0.0051617233 Lactobacillales o__Chlamydiales 1.109162e-03 0.0112564276 Chlamydiales o__Elusimicrobiales 1.104802e-03 0.0036746035 Elusimicrobiales o__ML615J-28 9.826848e-04 0.0037803511 ML615J-28 o__Brevinematales 8.957611e-04 0.0046437768 Brevinematales o__GWE2-31-10 8.620607e-04 0.0040717621 GWE2-31-10 o__Coriobacteriales 6.601149e-04 0.0013420095 Coriobacteriales o__CAJFEE01 6.063947e-04 0.0028904690 CAJFEE01 o__Methanomicrobiales 5.754579e-04 0.0026410958 Methanomicrobiales o__ 5.717583e-04 0.0021241114 o__Rs-D84 5.603757e-04 0.0031715201 Rs-D84 o__Rickettsiales 5.287290e-04 0.0027549629 Rickettsiales o__UBA1381 5.035832e-04 0.0015475012 UBA1381 o__Opitutales 4.901270e-04 0.0018532230 Opitutales o__Synergistales 3.666072e-04 0.0024311729 Synergistales o__Pseudomonadales 3.626249e-04 0.0029135461 Pseudomonadales o__UBA7702 2.450743e-04 0.0015747068 UBA7702 o__Cardiobacteriales 2.276453e-04 0.0029855408 Cardiobacteriales o__Pirellulales 1.908305e-04 0.0017144286 Pirellulales o__Victivallales 1.789455e-04 0.0015054509 Victivallales o__UBA4068 1.769355e-04 0.0005665926 UBA4068 o__Burkholderiales 1.721286e-04 0.0007779434 Burkholderiales o__Treponematales 1.581747e-04 0.0008279556 Treponematales o__Deferribacterales 1.413909e-04 0.0006340007 Deferribacterales o__UMGS1883 7.335614e-05 0.0004670412 UMGS1883 o__Methanomassiliicoccales 4.851518e-05 0.0006362706 Methanomassiliicoccales o__Eubacteriales 3.408400e-05 0.0001552477 Eubacteriales o__Rhodobacterales 2.776073e-05 0.0003101775 Rhodobacterales o__Tissierellales 2.729052e-05 0.0003579118 Tissierellales order_arrange &lt;- order_summary %&gt;% filter(!is.na(relabun)) %&gt;% group_by(order) %&gt;% summarise(mean=sum(relabun)) %&gt;% arrange(-mean) %&gt;% select(order) %&gt;% mutate(order= sub(&quot;^o__&quot;, &quot;&quot;, order)) %&gt;% pull() order_summary %&gt;% left_join(genome_metadata_all %&gt;% select(order,phylum) %&gt;% unique(),by=&quot;order&quot;) %&gt;% left_join(sample_metadata_all %&gt;% rename(host_order=order),by=&quot;sample&quot;) %&gt;% filter(order != &quot;o__&quot;) %&gt;% mutate(order= sub(&quot;^o__&quot;, &quot;&quot;, order)) %&gt;% filter(order %in% order_arrange[1:20]) %&gt;% mutate(order=factor(order,levels=rev(order_arrange[1:20]))) %&gt;% filter(relabun &gt; 0) %&gt;% ggplot(aes(x=relabun, y=order, group=order, color=phylum, fill=phylum)) + scale_color_manual(values=phylum_colors_all) + scale_fill_manual(values=phylum_colors_all) + #geom_boxplot(alpha=0.2) + geom_jitter(alpha=0.5) + facet_nested(. ~ species)+ theme_minimal() + theme(legend.position = &quot;none&quot;) 5.2.3 Family family_summary &lt;- genome_counts_filt_all %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% #reduce to minimum number of columns left_join(sample_metadata_all, by = join_by(sample == sample)) %&gt;% #append sample metadata left_join(genome_metadata_all, by = join_by(genome == genome)) %&gt;% #append genome metadata group_by(sample,family) %&gt;% summarise(relabun=sum(count)) family_summary %&gt;% filter(!is.na(relabun)) %&gt;% group_by(family) %&gt;% summarise(mean=mean(relabun),sd=sd(relabun)) %&gt;% mutate(family= sub(&quot;^f__&quot;, &quot;&quot;, family)) %&gt;% arrange(-mean) %&gt;% tt() tinytable_gg7zg0s56b9wc1bd8u06 .table td.tinytable_css_ye638kpart88z8chwvzn, .table th.tinytable_css_ye638kpart88z8chwvzn { border-bottom: solid 0.1em #d3d8dc; } family mean sd Lachnospiraceae 2.679049e-01 1.479098e-01 Bacteroidaceae 2.128971e-01 1.133002e-01 Tannerellaceae 7.843675e-02 4.086968e-02 Rikenellaceae 4.521289e-02 3.594946e-02 Marinifilaceae 3.815762e-02 3.130093e-02 Ruminococcaceae 3.516717e-02 2.681469e-02 UBA3700 3.100225e-02 3.669198e-02 Oscillospiraceae 2.542478e-02 2.063380e-02 Erysipelotrichaceae 2.220306e-02 3.495105e-02 1.854607e-02 2.537000e-02 Desulfovibrionaceae 1.762937e-02 1.684933e-02 Enterobacteriaceae 1.596443e-02 3.973100e-02 Helicobacteraceae 1.394838e-02 2.291339e-02 Acutalibacteraceae 1.129138e-02 2.182770e-02 Coprobacillaceae 9.854533e-03 1.610175e-02 Mycoplasmoidaceae 9.198005e-03 1.988191e-02 Pumilibacteraceae 8.303712e-03 2.717791e-02 UBA660 7.616380e-03 1.298673e-02 Akkermansiaceae 7.557137e-03 1.368902e-02 CAG-239 7.371042e-03 9.989587e-03 Gastranaerophilaceae 7.216239e-03 1.061888e-02 Anaerotignaceae 6.013824e-03 8.783101e-03 Anaeroplasmataceae 5.687338e-03 1.422618e-02 Butyricicoccaceae 5.289808e-03 6.576968e-03 CAG-74 4.607693e-03 1.032186e-02 CAG-508 4.495099e-03 8.141235e-03 Anaerovoracaceae 4.441054e-03 7.271621e-03 Vibrionaceae 4.421724e-03 1.848524e-02 Clostridiaceae 4.071744e-03 1.819943e-02 DTU072 3.904841e-03 7.233438e-03 Peptococcaceae 3.689298e-03 5.575429e-03 CAG-449 3.598003e-03 1.246597e-02 Sphaerochaetaceae 3.529054e-03 2.160118e-02 WRBM01 3.523614e-03 6.291393e-03 Diplorickettsiaceae 3.505108e-03 4.590552e-02 UBA932 3.368690e-03 8.602302e-03 Fusobacteriaceae 3.024136e-03 1.344898e-02 CAG-917 2.786813e-03 1.051273e-02 Acidaminococcaceae 2.551799e-03 4.905513e-03 Methanosarcinaceae 2.372541e-03 9.727454e-03 Borkfalkiaceae 2.215945e-03 9.726245e-03 UBA1242 1.975129e-03 4.034220e-03 CAG-274 1.901813e-03 4.757881e-03 Aeromonadaceae 1.724892e-03 1.089339e-02 CAG-288 1.623242e-03 5.036122e-03 Micrococcaceae 1.546507e-03 1.907650e-02 MGBC116941 1.403668e-03 4.908522e-03 CALTSX01 1.109162e-03 1.125643e-02 Elusimicrobiaceae 1.104802e-03 3.674604e-03 CAG-314 1.067128e-03 3.487523e-03 CAG-138 1.028579e-03 6.324693e-03 CALVMC01 9.864994e-04 3.349719e-03 RUG14156 9.300233e-04 2.736356e-03 UBA3830 9.142222e-04 2.758943e-03 Brevinemataceae 8.957611e-04 4.643777e-03 GWE2-31-10 8.620607e-04 4.071762e-03 Eggerthellaceae 6.601149e-04 1.342009e-03 CAJFEE01 6.063947e-04 2.890469e-03 Methanocorpusculaceae 5.754579e-04 2.641096e-03 Rs-D84 5.603757e-04 3.171520e-03 Muribaculaceae 5.226674e-04 3.051788e-03 CAG-313 5.117558e-04 2.193878e-03 UBA1381 5.035832e-04 1.547501e-03 LL51 4.763559e-04 1.852608e-03 CAG-698 4.709290e-04 2.164469e-03 UBA1997 4.208195e-04 2.382923e-03 Streptococcaceae 4.160441e-04 2.630200e-03 Enterococcaceae 4.090411e-04 1.517990e-03 CAG-465 3.788372e-04 1.164817e-03 Coprobacteraceae 3.767262e-04 1.347094e-03 Synergistaceae 3.666072e-04 2.431173e-03 Peptostreptococcaceae 3.652882e-04 1.348669e-03 Pseudomonadaceae 3.626249e-04 2.913546e-03 Massilibacillaceae 3.253008e-04 1.474960e-03 UBA3637 3.139388e-04 1.531614e-03 Metamycoplasmataceae 3.110466e-04 3.810180e-03 CHK158-818 3.095362e-04 9.740463e-04 CAG-631 2.706635e-04 1.015132e-03 Lactobacillaceae 2.576707e-04 2.262342e-03 UBA7702 2.450743e-04 1.574707e-03 Wohlfahrtiimonadaceae 2.276453e-04 2.985541e-03 CAG-977 2.225261e-04 1.355731e-03 SIG350 2.069507e-04 2.714132e-03 Thermoguttaceae 1.908305e-04 1.714429e-03 CAJFVJ01 1.892159e-04 1.389700e-03 Burkholderiaceae 1.721286e-04 7.779434e-04 Hepatoplasmataceae 1.654048e-04 1.179092e-03 Treponemataceae 1.581747e-04 8.279556e-04 UBA5755 1.525827e-04 5.351000e-04 Mucispirillaceae 1.413909e-04 6.340007e-04 UBA1234 1.381659e-04 5.154643e-04 Catellicoccaceae 9.608682e-05 8.591908e-04 CAG-272 9.588815e-05 7.206419e-04 Vagococcaceae 8.701072e-05 1.141135e-03 Victivallaceae 7.718385e-05 4.488404e-04 Azobacteroidaceae 7.440778e-05 9.758489e-04 UMGS1883 7.335614e-05 4.670412e-04 Cellulosilyticaceae 5.332328e-05 3.808652e-04 Methanomethylophilaceae 4.851518e-05 6.362706e-04 DUVY01 4.637858e-05 5.673763e-04 Paludibacteraceae 4.504653e-05 2.212459e-04 CAG-382 3.918633e-05 1.936551e-04 Eubacteriaceae 3.408400e-05 1.552477e-04 JAEDCM01 3.306564e-05 4.336518e-04 Rhodobacteraceae 2.776073e-05 3.101775e-04 Peptoniphilaceae 2.729052e-05 3.579118e-04 HGM11417 2.626128e-05 1.876693e-04 UBA4068 2.435275e-05 9.859687e-05 Microbacteriaceae 1.467237e-05 1.924263e-04 UBA9783 1.377110e-05 1.243972e-04 WCHB1-69 5.663380e-06 7.427454e-05 family_arrange &lt;- family_summary %&gt;% filter(!is.na(relabun)) %&gt;% group_by(family) %&gt;% summarise(mean=sum(relabun)) %&gt;% arrange(-mean) %&gt;% select(family) %&gt;% mutate(family= sub(&quot;^f__&quot;, &quot;&quot;, family)) %&gt;% pull() family_summary %&gt;% left_join(genome_metadata_all %&gt;% select(family,phylum) %&gt;% unique(),by=join_by(family==family)) %&gt;% left_join(sample_metadata_all,by=join_by(sample==sample)) %&gt;% filter(family != &quot;f__&quot;) %&gt;% mutate(family= sub(&quot;^f__&quot;, &quot;&quot;, family)) %&gt;% filter(family %in% family_arrange[1:20]) %&gt;% mutate(family=factor(family,levels=rev(family_arrange[1:20]))) %&gt;% filter(relabun &gt; 0) %&gt;% ggplot(aes(x=relabun, y=family, group=family, color=phylum, fill=phylum)) + scale_color_manual(values=phylum_colors_all) + scale_fill_manual(values=phylum_colors_all) + #geom_boxplot(alpha=0.2) + geom_jitter(alpha=0.5) + facet_nested(. ~ species)+ theme_minimal() + theme(legend.position = &quot;none&quot;) 5.2.4 Genus genus_summary &lt;- genome_counts_filt_all %&gt;% mutate_at(vars(-genome),~./sum(.)) %&gt;% #apply TSS nornalisation pivot_longer(-genome, names_to = &quot;sample&quot;, values_to = &quot;count&quot;) %&gt;% #reduce to minimum number of columns left_join(sample_metadata_all, by = join_by(sample == sample)) %&gt;% #append sample metadata left_join(genome_metadata_all, by = join_by(genome == genome)) %&gt;% #append genome metadata group_by(sample,genus) %&gt;% summarise(relabun=sum(count)) %&gt;% filter(genus != &quot;g__&quot;) genus_summary %&gt;% filter(!is.na(relabun)) %&gt;% group_by(genus) %&gt;% summarise(mean=mean(relabun),sd=sd(relabun)) %&gt;% arrange(-mean) %&gt;% tt() tinytable_vnoh0dcviyeqomjxf7b6 .table td.tinytable_css_x3y9okaynseu4gd49ltt, .table th.tinytable_css_x3y9okaynseu4gd49ltt { border-bottom: solid 0.1em #d3d8dc; } genus mean sd g__Bacteroides 1.492633e-01 9.145770e-02 g__Parabacteroides 6.838309e-02 3.825177e-02 g__Phocaeicola 5.590755e-02 4.767695e-02 g__Odoribacter 3.698228e-02 3.157692e-02 g__Alistipes 3.688633e-02 3.262665e-02 g__Kineothrix 3.485495e-02 7.746321e-02 g__JAAYNV01 3.180220e-02 5.544362e-02 g__Roseburia 2.034157e-02 6.055895e-02 g__Acetatifactor 1.353817e-02 2.662322e-02 g__Ventrimonas 1.119879e-02 1.784188e-02 g__CAG-95 1.116264e-02 2.245897e-02 g__Helicobacter_J 1.041623e-02 1.995870e-02 g__Parabacteroides_B 9.901565e-03 1.173939e-02 g__Breznakia 9.810792e-03 2.108634e-02 g__Mycoplasmoides 9.198005e-03 1.988191e-02 g__Akkermansia 7.557137e-03 1.368902e-02 g__Velocimicrobium 7.454088e-03 1.907730e-02 g__RGIG4733 7.157888e-03 2.514900e-02 g__Hungatella_A 6.350838e-03 9.898917e-03 g__UBA866 5.974162e-03 1.279000e-02 g__Desulfovibrio 5.709603e-03 9.315901e-03 g__Anaerotruncus 5.630278e-03 7.811119e-03 g__Thomasclavelia 5.493662e-03 1.248939e-02 g__Intestinimonas 5.301231e-03 6.478704e-03 g__Bilophila 5.134848e-03 6.647822e-03 g__Ruthenibacterium 4.907256e-03 9.923689e-03 g__Enterocloster 4.615640e-03 6.281140e-03 g__JALFVM01 4.503361e-03 1.060918e-02 g__Vibrio 4.421724e-03 1.848524e-02 g__Hespellia 4.402515e-03 1.129796e-02 g__Fimenecus 4.242280e-03 1.435771e-02 g__14-2 3.563480e-03 1.647062e-02 g__Clostridium_Q 3.535110e-03 4.975653e-03 g__NHYM01 3.532146e-03 9.913909e-03 g__Spiro-02 3.529054e-03 2.160118e-02 g__Aquirickettsiella 3.505108e-03 4.590552e-02 g__Copromonas 3.447747e-03 4.581581e-03 g__Lawsonibacter 3.443311e-03 5.211912e-03 g__Egerieousia 3.368690e-03 8.602302e-03 g__Protoclostridium 3.296536e-03 2.553531e-02 g__Enterobacter 3.191565e-03 1.402631e-02 g__Lacrimispora 3.189242e-03 7.287909e-03 g__Oscillibacter 3.157271e-03 4.419607e-03 g__CHH4-2 3.075367e-03 5.253794e-03 g__Escherichia 3.000053e-03 1.115703e-02 g__Limiplasma 2.969019e-03 7.133192e-03 g__Rikenella 2.939128e-03 6.055218e-03 g__Sarcina 2.877939e-03 1.630802e-02 g__CAZU01 2.870401e-03 4.887287e-03 g__Fusobacterium_A 2.859566e-03 1.339771e-02 g__Dielma 2.815223e-03 6.874781e-03 g__OM05-12 2.791990e-03 5.749748e-03 g__Phascolarctobacterium 2.551799e-03 4.905513e-03 g__Fimivivens 2.467945e-03 3.688432e-03 g__MGBC136627 2.446550e-03 6.005822e-03 g__MGBC143606 2.440758e-03 7.414283e-03 g__Methanimicrococcus 2.372541e-03 9.727454e-03 g__Intestinibacillus 2.365302e-03 5.280365e-03 g__Hungatella 2.292660e-03 4.692286e-03 g__Mailhella 2.254541e-03 3.960166e-03 g__Pseudoflavonifractor 2.140159e-03 5.519017e-03 g__Gemmiger 2.112060e-03 6.521526e-03 g__MGBC140009 2.031711e-03 5.716638e-03 g__Lachnotalea 2.012696e-03 5.442239e-03 g__Pelethenecus 2.008513e-03 8.013717e-03 g__WRDF01 1.983926e-03 3.923816e-03 g__MGBC131033 1.973766e-03 3.165900e-03 g__Dysosmobacter 1.947698e-03 2.768625e-03 g__Negativibacillus 1.942876e-03 4.332910e-03 g__Coprobacillus 1.934097e-03 3.859945e-03 g__Angelakisella 1.884111e-03 3.631754e-03 g__RGIG6463 1.836103e-03 3.631321e-03 g__MGBC165282 1.805128e-03 4.854526e-03 g__Buttiauxella 1.783363e-03 6.842193e-03 g__JAAYQI01 1.771220e-03 3.100609e-03 g__Limenecus 1.757957e-03 3.763048e-03 g__Aeromonas 1.724892e-03 1.089339e-02 g__Agathobaculum 1.691308e-03 3.310944e-03 g__Citrobacter 1.678009e-03 7.050371e-03 g__Coproplasma 1.676723e-03 9.512497e-03 g__SZUA-378 1.657792e-03 1.399271e-02 g__Bacteroides_E 1.646079e-03 2.158813e-02 g__Eisenbergiella 1.567253e-03 3.864070e-03 g__Acaricomes 1.546507e-03 1.907650e-02 g__SIG332 1.531952e-03 9.459875e-03 g__CAG-269 1.410352e-03 3.725174e-03 g__SIG299 1.380919e-03 7.119758e-03 g__NSJ-61 1.352789e-03 4.082352e-03 g__RGIG3002 1.316711e-03 4.431909e-03 g__Marseille-P3106 1.288557e-03 2.227308e-03 g__WRHT01 1.286176e-03 3.892975e-03 g__Kosakonia 1.279803e-03 1.185315e-02 g__Emergencia 1.251317e-03 4.473343e-03 g__UMGS1251 1.238852e-03 3.182570e-03 g__Tidjanibacter 1.233090e-03 3.465801e-03 g__C-19 1.222456e-03 4.824577e-03 g__Clostridium 1.193805e-03 7.940942e-03 g__Butyricimonas 1.175332e-03 2.982029e-03 g__MGBC116941 1.143994e-03 4.759873e-03 g__Anaerotignum 1.131763e-03 1.921774e-03 g__Evtepia 1.125245e-03 2.346285e-03 g__Scatousia 1.113860e-03 3.186063e-03 g__Scandinavium 1.110443e-03 1.289658e-02 g__CALTSX01 1.109162e-03 1.125643e-02 g__Anaeroplasma 1.099325e-03 4.010838e-03 g__UBA2658 1.093757e-03 2.645590e-03 g__Blautia_A 1.062518e-03 2.897013e-03 g__Proteus 1.058683e-03 1.335374e-02 g__Ruminococcus_E 1.029855e-03 6.336954e-03 g__JAHHSE01 1.016881e-03 2.081230e-03 g__Anaerostipes 9.993568e-04 6.214220e-03 g__CAJLXD01 9.907104e-04 2.932215e-03 g__Phocaeicola_A 9.892770e-04 4.013536e-03 g__Fournierella 9.581274e-04 2.619171e-03 g__CAG-345 9.417628e-04 4.156477e-03 g__Brevinema 8.957611e-04 4.643777e-03 g__Harryflintia 8.884142e-04 2.505438e-03 g__C-53 8.874160e-04 4.469056e-03 g__Acutalibacter 8.861698e-04 1.776887e-03 g__Aminipila 8.810006e-04 2.463410e-03 g__Spyradomonas 8.525628e-04 4.191135e-03 g__Ventrenecus 8.497155e-04 2.794178e-03 g__CAG-273 8.444700e-04 4.049118e-03 g__Caccovivens 8.366088e-04 2.621483e-03 g__VSOB01 8.152912e-04 3.184675e-03 g__CAG-1782 7.959184e-04 3.106148e-03 g__RGIG1896 7.925359e-04 1.323233e-03 g__Ruminiclostridium_E 7.797273e-04 3.917287e-03 g__CAG-582 7.735000e-04 4.481513e-03 g__Blautia 7.711825e-04 1.670642e-03 g__Klebsiella 7.596956e-04 3.591632e-03 g__Bariatricus 7.585807e-04 1.661520e-03 g__Extibacter 7.391720e-04 1.570615e-03 g__Stoquefichus 7.391191e-04 3.131298e-03 g__CALURL01 7.372695e-04 2.459028e-03 g__JAAWBF01 7.270628e-04 2.291304e-03 g__UBA1436 7.244074e-04 2.911088e-03 g__UBA5578 6.989678e-04 4.423923e-03 g__IOR16 6.837972e-04 1.623524e-03 g__CAG-288 6.814792e-04 2.646198e-03 g__Clostridium_AI 6.796597e-04 7.646021e-03 g__MGBC133411 6.731026e-04 1.995666e-03 g__CALUVN01 6.547298e-04 1.647970e-03 g__Scatenecus 6.527575e-04 2.463681e-03 g__UBA7185 6.237137e-04 2.850324e-03 g__Faecousia 6.199737e-04 2.757282e-03 g__Muricomes 6.193494e-04 2.526333e-03 g__Scatacola_A 6.113889e-04 2.209083e-03 g__Faecalibacillus 6.073162e-04 3.608509e-03 g__Harrysmithimonas 6.063947e-04 2.890469e-03 g__CAJTFG01 5.848933e-04 3.604164e-03 g__Bacilliculturomica 5.704876e-04 1.402287e-03 g__Faecisoma 5.592534e-04 2.521527e-03 g__Methanocorpusculum 5.525498e-04 2.600043e-03 g__Anaerocaecibacter 5.522731e-04 2.721369e-03 g__CAKQDS01 5.418129e-04 2.199150e-03 g__Salmonella 5.276877e-04 4.414352e-03 g__RGIG8482 5.219404e-04 1.949521e-03 g__Galloscillospira_A 5.158552e-04 9.715988e-04 g__Fimivicinus 5.153979e-04 2.165963e-03 g__Fimimorpha 4.980684e-04 2.338325e-03 g__JAGAJR01 4.971561e-04 3.285758e-03 g__Caccenecus 4.949970e-04 1.527726e-03 g__UBA1794 4.933027e-04 1.707288e-03 g__UBA1417 4.791205e-04 1.029684e-03 g__UBA940 4.740035e-04 1.712347e-03 g__CAJFPI01 4.629136e-04 1.001336e-03 g__Lactonifactor 4.603409e-04 1.417494e-03 g__Clostridium_AQ 4.466972e-04 1.736532e-03 g__Onthovicinus 4.445381e-04 2.331257e-03 g__Buchnera 4.433102e-04 5.813959e-03 g__Clostridium_N 4.402910e-04 2.950622e-03 g__CAKRHR01 4.367869e-04 2.278772e-03 g__DXYV01 4.360731e-04 1.398616e-03 g__RGIG1902 4.283551e-04 7.371513e-04 g__SIG32 4.227733e-04 1.529877e-03 g__HGM11386 4.218531e-04 1.727808e-03 g__Butyrivibrio_A 4.136198e-04 3.448206e-03 g__FLUQ01 4.120756e-04 9.918380e-04 g__CAG-590 4.073011e-04 1.856155e-03 g__Faecimonas 4.024457e-04 1.952064e-03 g__MGBC107952 4.009827e-04 1.132923e-03 g__Ventrisoma 3.996970e-04 1.047519e-03 g__Beduini 3.891743e-04 1.496954e-03 g__RUG14156 3.667219e-04 1.782969e-03 g__Cloacibacillus 3.666072e-04 2.431173e-03 g__Pseudomonas 3.626249e-04 2.913546e-03 g__Lawsonia 3.609631e-04 2.976114e-03 g__Marvinbryantia 3.602193e-04 1.589621e-03 g__CAG-465 3.584980e-04 1.153031e-03 g__Coprobacter 3.568144e-04 1.332767e-03 g__HGM12998 3.510965e-04 1.268564e-03 g__Faecenecus 3.477335e-04 1.547966e-03 g__RACS-047 3.410345e-04 1.305915e-03 g__RGIG4097 3.394551e-04 2.512766e-03 g__CAG-303 3.354250e-04 2.253817e-03 g__Paraeggerthella 3.306477e-04 7.881768e-04 g__Scatavimonas 3.292069e-04 2.998578e-03 g__Scatocola 3.170079e-04 2.010498e-03 g__CAKTEE01 3.148626e-04 1.817047e-03 g__UBA7488 3.139388e-04 1.531614e-03 g__Caccomorpha 3.135442e-04 8.132352e-04 g__UBA710 3.110466e-04 3.810180e-03 g__Gallibacteroides 3.095362e-04 9.740463e-04 g__Lachnospira 3.070567e-04 1.867816e-03 g__CALXUC01 3.067121e-04 1.882934e-03 g__JAIHAL01 2.938058e-04 1.765062e-03 g__Zag111 2.895640e-04 1.695054e-03 g__Ventricola 2.878743e-04 1.507071e-03 g__Scatomorpha 2.765635e-04 7.278705e-04 g__Lachnoclostridium_B 2.763740e-04 8.906298e-04 g__UBA5026 2.752265e-04 1.128502e-03 g__Caccosoma 2.706635e-04 1.015132e-03 g__Catenibacillus 2.681525e-04 7.308965e-04 g__JAGBWK01 2.667486e-04 2.985884e-03 g__RGIG4057 2.634560e-04 1.610134e-03 g__Oliverpabstia 2.606026e-04 2.224448e-03 g__UMGS1202 2.590747e-04 8.409060e-04 g__HGM05232 2.559188e-04 7.315989e-04 g__Merdicola 2.528427e-04 1.910082e-03 g__Cryptoclostridium 2.450743e-04 1.574707e-03 g__UMGS2016 2.439149e-04 1.057064e-03 g__CALXWF01 2.437349e-04 8.980698e-04 g__Onthocola_B 2.336122e-04 1.097069e-03 g__RUG14670 2.334104e-04 1.268072e-03 g__UMGS1663 2.320796e-04 1.174466e-03 g__Plesiomonas 2.292023e-04 2.122607e-03 g__SIG230 2.280915e-04 9.725989e-04 g__Butyricicoccus 2.280100e-04 1.179904e-03 g__Butyribacter 2.278963e-04 1.554091e-03 g__HGM13233 2.269566e-04 1.044833e-03 g__JAHHUA01 2.254978e-04 1.219591e-03 g__CALWZU01 2.244363e-04 7.795409e-04 g__CAG-977 2.225261e-04 1.355731e-03 g__Aphodocola 2.222897e-04 1.161474e-03 g__CALXRO01 2.218957e-04 1.970482e-03 g__Heteroruminococcus 2.202694e-04 9.244284e-04 g__JAJQAW01 2.169416e-04 7.681528e-04 g__Onthenecus 2.147993e-04 1.115093e-03 g__RGIG7389 2.135590e-04 6.700920e-04 g__Faecivivens 2.124632e-04 6.117535e-04 g__Onthousia 2.092884e-04 1.156334e-03 g__SIG350 2.069507e-04 2.714132e-03 g__Zhenpiania 2.019229e-04 4.491625e-04 g__WQYD01 2.010363e-04 7.107867e-04 g__Schmidhempelia 1.993159e-04 2.428842e-03 g__CAJKWP01 1.983903e-04 1.179880e-03 g__Enterococcus_B 1.954034e-04 9.681045e-04 g__JAILHT01 1.916321e-04 1.904125e-03 g__RGIG3701 1.908305e-04 1.714429e-03 g__Ignatzschineria 1.894434e-04 2.484527e-03 g__Avoscillospira_A 1.849958e-04 7.621367e-04 g__RUG12867 1.830035e-04 9.744369e-04 g__CAG-245 1.810191e-04 1.094579e-03 g__Anaerovorax 1.807911e-04 8.302159e-04 g__Raoultibacter 1.797664e-04 8.292516e-04 g__UMGS1585 1.752553e-04 7.702768e-04 g__Oxalobacter 1.721286e-04 7.779434e-04 g__Hafnia 1.709747e-04 1.378637e-03 g__CAG-510 1.665191e-04 8.640457e-04 g__Kluyvera 1.663693e-04 1.308586e-03 g__Hepatoplasma 1.654048e-04 1.179092e-03 g__UMGS75 1.626765e-04 1.435280e-03 g__JADFUS01 1.619273e-04 6.573895e-04 g__UBA7405 1.612771e-04 2.016590e-03 g__Streptococcus 1.564224e-04 2.051461e-03 g__CAG-56 1.525484e-04 6.872474e-04 g__CCUG-7971 1.523791e-04 6.252194e-04 g__Barb7 1.520997e-04 1.994769e-03 g__Gallispira 1.502610e-04 1.952849e-03 g__Lapidilactobacillus 1.409595e-04 1.848667e-03 g__Butyricicoccus_A 1.367025e-04 7.053366e-04 g__Limousia 1.360041e-04 6.955315e-04 g__Galligastranaerophilus 1.353461e-04 7.910321e-04 g__RGIG8607 1.330395e-04 8.153357e-04 g__Romboutsia_C 1.324145e-04 8.281891e-04 g__Enterococcus 1.324071e-04 8.356372e-04 g__Lactococcus_A 1.314638e-04 1.483600e-03 g__Leclercia 1.312203e-04 8.697175e-04 g__Pelethosoma 1.307797e-04 6.745119e-04 g__Lactococcus 1.281579e-04 7.899264e-04 g__MGBC124762 1.275812e-04 3.998533e-04 g__MGBC102946 1.258646e-04 5.024944e-04 g__CALXDZ01 1.242807e-04 4.083501e-04 g__Alectryocaccomicrobium 1.235486e-04 7.824254e-04 g__Avelusimicrobium 1.231087e-04 5.021372e-04 g__Murimonas 1.213808e-04 6.752085e-04 g__CALXIC01 1.201073e-04 4.762615e-04 g__Eubacterium_R 1.155168e-04 6.661566e-04 g__CAJMNU01 1.144585e-04 4.126897e-04 g__Metalachnospira 1.123175e-04 3.821465e-04 g__MGBC162267 1.119052e-04 5.900730e-04 g__JAEXFV01 1.108700e-04 5.225033e-04 g__UBA4636 1.101747e-04 5.696311e-04 g__Ruminococcus_G 1.085800e-04 5.727591e-04 g__JAHZFN01 1.041903e-04 4.947845e-04 g__Alistipes_A 1.023731e-04 3.424616e-04 g__Adamsella 1.005056e-04 8.259359e-04 g__JAAVYW01 9.886611e-05 3.596087e-04 g__UBA6345 9.776278e-05 5.890564e-04 g__UMGS1601 9.678895e-05 1.027188e-03 g__UMGS946 9.645721e-05 7.355573e-04 g__Catellicoccus 9.608682e-05 8.591908e-04 g__Novisyntrophococcus 9.472371e-05 6.442503e-04 g__CAG-41 9.123793e-05 6.894142e-04 g__CAG-307 9.056080e-05 6.397842e-04 g__CAKPCJ01 8.942488e-05 4.738890e-04 g__JAEWLZ01 8.871037e-05 1.125625e-03 g__Scybalousia 8.811278e-05 6.607347e-04 g__JAGZHZ01 8.729754e-05 5.699666e-04 g__Vagococcus 8.701072e-05 1.141135e-03 g__CAG-177 8.598892e-05 6.008884e-04 g__JALENY01 8.400275e-05 7.456506e-04 g__UBA1234 8.317669e-05 3.789843e-04 g__Eggerthella 8.252648e-05 3.589205e-04 g__Paraclostridium 8.049454e-05 6.908705e-04 g__UBA9414 7.948449e-05 4.143991e-04 g__Howiella 7.930957e-05 4.148145e-04 g__WRAV01 7.609451e-05 3.151892e-04 g__1XD8-76 7.561457e-05 5.115263e-04 g__Coprosoma 7.472227e-05 3.452372e-04 g__Symbiothrix 7.440778e-05 9.758489e-04 g__Eubacterium_F 7.419399e-05 4.473563e-04 g__CALVUN01 7.360091e-05 2.973254e-04 g__SIG471 7.262934e-05 2.760627e-04 g__PeH17 7.223390e-05 6.588230e-04 g__CALVXC01 7.196506e-05 6.695435e-04 g__RGIG4709 6.834702e-05 3.413827e-04 g__NSJ-51 6.807371e-05 2.871386e-04 g__Stercorousia 6.781125e-05 5.448313e-04 g__Gordonibacter 6.717435e-05 2.612900e-04 g__MGBC114844 6.659331e-05 4.105335e-04 g__Pelethomonas 6.618416e-05 2.448069e-04 g__Victivallis 6.489695e-05 4.051890e-04 g__RGIG9115 6.478642e-05 4.986757e-04 g__UBA1405 6.337712e-05 3.647934e-04 g__MGBC164599 6.309143e-05 2.415782e-04 g__UMGS1754 6.307099e-05 4.707822e-04 g__CAG-196 6.303657e-05 3.691902e-04 g__Fructobacillus 6.009139e-05 7.880912e-04 g__Anaeromassilibacillus 5.991756e-05 4.100453e-04 g__MGBC120314 5.725195e-05 5.476452e-04 g__JAAZGC01 5.557462e-05 5.355315e-04 g__CAG-314 5.351060e-05 4.224425e-04 g__Cellulosilyticum 5.332328e-05 3.808652e-04 g__Enterousia 5.188415e-05 4.191287e-04 g__UMGS687 5.126641e-05 4.219539e-04 g__Erysipelothrix 5.024616e-05 6.589722e-04 g__Holdemania 4.990583e-05 2.392481e-04 g__Limivicinus 4.957042e-05 6.142188e-04 g__RGIG4790 4.884680e-05 4.322050e-04 g__Enterococcus_D 4.788989e-05 4.103756e-04 g__UBA933 4.778105e-05 6.266426e-04 g__Copranaerobaculum 4.777314e-05 2.215807e-04 g__SIG603 4.629171e-05 3.498294e-04 g__CAKVBE01 4.606653e-05 6.041568e-04 g__Mobilisporobacter 4.560952e-05 4.555415e-04 g__QVMH01 4.504653e-05 2.212459e-04 g__Hydrogenoanaerobacterium 4.475602e-05 1.749987e-04 g__CALWRB01 4.428930e-05 1.565875e-04 g__HGM16780 4.234877e-05 3.457660e-04 g__JAFSEX01 4.208347e-05 5.006300e-04 g__CALWTV01 4.031353e-05 4.868653e-04 g__Ruminococcus 4.026239e-05 5.280363e-04 g__Providencia 3.947092e-05 4.865493e-04 g__Woodwardibium 3.918633e-05 1.936551e-04 g__Frigididesulfovibrio 3.840477e-05 5.036739e-04 g__Wohlfahrtiimonas 3.820192e-05 5.010134e-04 g__Eubacterium 3.408400e-05 1.552477e-04 g__Morganella 3.398929e-05 4.457653e-04 g__Enterococcus_J 3.334065e-05 4.372585e-04 g__Neoruminococcus 3.310136e-05 1.689688e-04 g__RUG13868 3.198945e-05 2.291845e-04 g__UBA1394 3.162426e-05 2.289144e-04 g__JAAZDN01 3.052698e-05 4.003575e-04 g__CAG-452 2.832554e-05 1.923112e-04 g__Paracoccus 2.776073e-05 3.101775e-04 g__JAILQS01 2.736465e-05 1.827364e-04 g__CAKNOI01 2.732478e-05 3.262900e-04 g__RGIG2219 2.626128e-05 1.876693e-04 g__CAJOJR01 2.582848e-05 2.076085e-04 g__Ventrousia 2.576615e-05 1.230955e-04 g__HGM13862 2.435275e-05 9.859687e-05 g__Methanoplasma 2.278412e-05 2.988110e-04 g__Heteroclostridium 2.072692e-05 1.253234e-04 g__RGIG5057 2.033912e-05 1.439685e-04 g__Heteroscilispira 2.015044e-05 1.254733e-04 g__RGIG3091 1.786547e-05 2.343035e-04 g__RGIG446 1.709062e-05 8.960743e-05 g__Lentilactobacillus 1.631166e-05 2.139254e-04 g__Microbacterium 1.467237e-05 1.924263e-04 g__Alloscillospira 1.272669e-05 1.020529e-04 g__CALXXL01 1.228690e-05 7.294195e-05 g__SIG208 6.550316e-06 5.024769e-05 g__CAKVLS01 6.485638e-06 5.776699e-05 g__JAGVVH01 5.663380e-06 7.427454e-05 genus_arrange &lt;- genus_summary %&gt;% group_by(genus) %&gt;% summarise(mean=sum(relabun)) %&gt;% filter(genus != &quot;g__&quot;)%&gt;% arrange(-mean) %&gt;% select(genus) %&gt;% mutate(genus= sub(&quot;^g__&quot;, &quot;&quot;, genus)) %&gt;% pull() genus_summary %&gt;% left_join(genome_metadata_all %&gt;% select(genus,phylum) %&gt;% unique(),by=join_by(genus==genus)) %&gt;% left_join(sample_metadata_all,by=join_by(sample==sample)) %&gt;% mutate(genus= sub(&quot;^g__&quot;, &quot;&quot;, genus)) %&gt;% filter(genus %in% genus_arrange[1:20]) %&gt;% mutate(genus=factor(genus,levels=rev(genus_arrange[1:20]))) %&gt;% filter(relabun &gt; 0) %&gt;% ggplot(aes(x=relabun, y=genus, group=genus, color=phylum)) + scale_color_manual(values=phylum_colors_all) + #geom_boxplot() + geom_jitter(alpha=0.5) + facet_nested(. ~ species)+ theme_minimal() 5.3 Compositional dissimilarities beta_q0n &lt;- genome_counts_filt_all %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% filter(rowSums(. != 0, na.rm = TRUE) &gt; 0) %&gt;% select_if(~!all(. == 0)) %&gt;% hillpair(., q = 0) beta_q1n &lt;- genome_counts_filt_all %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% filter(rowSums(. != 0, na.rm = TRUE) &gt; 0) %&gt;% select_if(~!all(. == 0)) %&gt;% hillpair(., q = 1) beta_q1p &lt;- genome_counts_filt_all %&gt;% column_to_rownames(., &quot;genome&quot;) %&gt;% filter(rowSums(. != 0, na.rm = TRUE) &gt; 0) %&gt;% select_if(~!all(. == 0)) %&gt;% hillpair(., q = 1, tree = genome_tree_all) 5.3.1 Richness dissimilarity plot nmds_q0n &lt;- beta_q0n$S %&gt;% vegan::metaMDS(., trymax = 500, k = 2, trace=0) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% dplyr::left_join(sample_metadata_all, by = &quot;sample&quot;) %&gt;% group_by(species,population) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() nmds_q0n %&gt;% ggplot(aes(x = NMDS1, y = NMDS2, color = species, fill = species, shape = population_type)) + geom_point(size = 2) + scale_color_manual(values=c(&quot;#f48153&quot;,&quot;#83d3d4&quot;,&quot;#2d8183&quot;,&quot;#910c07&quot;))+ # stat_ellipse(aes(color = beta_q1n_nmds$Groups))+ geom_segment(aes(x = x_cen, y = y_cen, xend = NMDS1, yend = NMDS2), alpha = 0.5) + theme_classic() + theme( axis.text.x = element_text(size = 12), axis.text.y = element_text(size = 12), axis.title = element_text(size = 20, face = &quot;bold&quot;), axis.text = element_text(face = &quot;bold&quot;, size = 18), panel.background = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size = 16), legend.title = element_text(size = 18), legend.position = &quot;right&quot;, legend.box = &quot;vertical&quot; ) + labs(shape=&quot;Population type&quot;,color=&quot;Species&quot;,fill=&quot;Species&quot;) 5.3.2 Neutral diversity dissimilarity plot nmds_q1n &lt;- beta_q1n$S %&gt;% vegan::metaMDS(., trymax = 500, k = 2, trace=0) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% dplyr::left_join(sample_metadata_all, by = &quot;sample&quot;) %&gt;% group_by(species,population) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() nmds_q1n %&gt;% ggplot(aes(x = NMDS1, y = NMDS2, color = species, fill = species, shape = population_type)) + geom_point(size = 2) + scale_color_manual(values=c(&quot;#f48153&quot;,&quot;#83d3d4&quot;,&quot;#2d8183&quot;,&quot;#910c07&quot;))+ # stat_ellipse(aes(color = beta_q1n_nmds$Groups))+ geom_segment(aes(x = x_cen, y = y_cen, xend = NMDS1, yend = NMDS2), alpha = 0.5) + theme_classic() + theme( axis.text.x = element_text(size = 12), axis.text.y = element_text(size = 12), axis.title = element_text(size = 20, face = &quot;bold&quot;), axis.text = element_text(face = &quot;bold&quot;, size = 18), panel.background = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size = 16), legend.title = element_text(size = 18), legend.position = &quot;right&quot;, legend.box = &quot;vertical&quot; ) + labs(shape=&quot;Population type&quot;,color=&quot;Species&quot;,fill=&quot;Species&quot;) 5.3.3 Phylogenetic diversity dissimilarity plot nmds_q1p &lt;- beta_q1p$S %&gt;% vegan::metaMDS(., trymax = 500, k = 2, trace=0) %&gt;% vegan::scores() %&gt;% as_tibble(., rownames = &quot;sample&quot;) %&gt;% dplyr::left_join(sample_metadata_all, by = &quot;sample&quot;) %&gt;% group_by(species,population) %&gt;% mutate(x_cen = mean(NMDS1, na.rm = TRUE)) %&gt;% mutate(y_cen = mean(NMDS2, na.rm = TRUE)) %&gt;% ungroup() nmds_q1p %&gt;% ggplot(aes(x = NMDS1, y = NMDS2, color = species, fill = species, shape = population_type)) + geom_point(size = 2) + scale_color_manual(values=c(&quot;#f48153&quot;,&quot;#83d3d4&quot;,&quot;#2d8183&quot;,&quot;#910c07&quot;))+ # stat_ellipse(aes(color = beta_q1n_nmds$Groups))+ geom_segment(aes(x = x_cen, y = y_cen, xend = NMDS1, yend = NMDS2), alpha = 0.5) + theme_classic() + theme( axis.text.x = element_text(size = 12), axis.text.y = element_text(size = 12), axis.title = element_text(size = 20, face = &quot;bold&quot;), axis.text = element_text(face = &quot;bold&quot;, size = 18), panel.background = element_blank(), axis.line = element_line(size = 0.5, linetype = &quot;solid&quot;, colour = &quot;black&quot;), legend.text = element_text(size = 16), legend.title = element_text(size = 18), legend.position = &quot;right&quot;, legend.box = &quot;vertical&quot; ) + labs(shape=&quot;Population type&quot;,color=&quot;Species&quot;,fill=&quot;Species&quot;) "],["alpha-diversity.html", "Chapter 6 Alpha diversity", " Chapter 6 Alpha diversity Comparison of overall alpha diversities of sampled populations. load(&quot;data/data_podarcis_all.Rdata&quot;) # Calculate Hill numbers richness &lt;- genome_counts_filt_all %&gt;% column_to_rownames(var = &quot;genome&quot;) %&gt;% dplyr::select(where(~ !all(. == 0))) %&gt;% hilldiv(., q = 0) %&gt;% t() %&gt;% as.data.frame() %&gt;% dplyr::rename(richness = 1) %&gt;% rownames_to_column(var = &quot;sample&quot;) neutral &lt;- genome_counts_filt_all %&gt;% column_to_rownames(var = &quot;genome&quot;) %&gt;% dplyr::select(where(~ !all(. == 0))) %&gt;% hilldiv(., q = 1) %&gt;% t() %&gt;% as.data.frame() %&gt;% dplyr::rename(neutral = 1) %&gt;% rownames_to_column(var = &quot;sample&quot;) phylogenetic &lt;- genome_counts_filt_all %&gt;% column_to_rownames(var = &quot;genome&quot;) %&gt;% dplyr::select(where(~ !all(. == 0))) %&gt;% hilldiv(., q = 1, tree = genome_tree_all) %&gt;% t() %&gt;% as.data.frame() %&gt;% dplyr::rename(phylogenetic = 1) %&gt;% rownames_to_column(var = &quot;sample&quot;) # Aggregate basal GIFT into elements dist &lt;- genome_gifts_all[genome_counts_filt_all$genome[genome_counts_filt_all$genome %in% rownames(genome_gifts_all)],] %&gt;% to.elements(., GIFT_db) %&gt;% traits2dist(., method = &quot;gower&quot;) functional &lt;- genome_counts_filt_all %&gt;% filter(genome %in% colnames(dist)) %&gt;% column_to_rownames(var = &quot;genome&quot;) %&gt;% dplyr::select(where(~ !all(. == 0))) %&gt;% hilldiv(., q = 1, dist = dist) %&gt;% t() %&gt;% as.data.frame() %&gt;% dplyr::rename(functional = 1) %&gt;% rownames_to_column(var = &quot;sample&quot;) %&gt;% mutate(functional = if_else(is.nan(functional), 1, functional)) # Merge all metrics alpha_div &lt;- richness %&gt;% full_join(neutral, by = join_by(sample == sample)) %&gt;% full_join(phylogenetic, by = join_by(sample == sample)) %&gt;% full_join(functional, by = join_by(sample == sample)) #Richness alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(sample_metadata_all, by = join_by(sample == sample)) %&gt;% filter(metric==&quot;richness&quot;) %&gt;% ggplot(aes(y = value, x = population_type, group=population_type, color=population_type, fill=population_type)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Population type&quot;, breaks=c(&quot;island&quot;,&quot;islet&quot;), values=c(&quot;#6A9AC3&quot;,&quot;#AFD699&quot;)) + scale_fill_manual(name=&quot;Population type&quot;, breaks=c(&quot;island&quot;,&quot;islet&quot;), values=c(&quot;#6A9AC350&quot;,&quot;#AFD69950&quot;)) + facet_wrap(. ~ species, scales = &quot;fixed&quot;, ncol=5) + coord_cartesian(xlim = c(1, NA)) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.x = element_text(angle = 45, hjust = 1) ) #Neutral alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(sample_metadata_all, by = join_by(sample == sample)) %&gt;% filter(metric==&quot;neutral&quot;) %&gt;% ggplot(aes(y = value, x = population_type, group=population_type, color=population_type, fill=population_type)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Population type&quot;, breaks=c(&quot;island&quot;,&quot;islet&quot;), values=c(&quot;#6A9AC3&quot;,&quot;#AFD699&quot;)) + scale_fill_manual(name=&quot;Population type&quot;, breaks=c(&quot;island&quot;,&quot;islet&quot;), values=c(&quot;#6A9AC350&quot;,&quot;#AFD69950&quot;)) + facet_wrap(. ~ species, scales = &quot;fixed&quot;, ncol=5) + coord_cartesian(xlim = c(1, NA)) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.x = element_text(angle = 45, hjust = 1) ) #Phylogenetic alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(sample_metadata_all, by = join_by(sample == sample)) %&gt;% filter(metric==&quot;phylogenetic&quot;) %&gt;% ggplot(aes(y = value, x = population_type, group=population_type, color=population_type, fill=population_type)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Population type&quot;, breaks=c(&quot;island&quot;,&quot;islet&quot;), values=c(&quot;#6A9AC3&quot;,&quot;#AFD699&quot;)) + scale_fill_manual(name=&quot;Population type&quot;, breaks=c(&quot;island&quot;,&quot;islet&quot;), values=c(&quot;#6A9AC350&quot;,&quot;#AFD69950&quot;)) + facet_wrap(. ~ species, scales = &quot;fixed&quot;, ncol=5) + coord_cartesian(xlim = c(1, NA)) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.x = element_text(angle = 45, hjust = 1) ) #Functional alpha_div %&gt;% pivot_longer(-sample, names_to = &quot;metric&quot;, values_to = &quot;value&quot;) %&gt;% left_join(sample_metadata_all, by = join_by(sample == sample)) %&gt;% filter(metric==&quot;functional&quot;) %&gt;% ggplot(aes(y = value, x = population_type, group=population_type, color=population_type, fill=population_type)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Population type&quot;, breaks=c(&quot;island&quot;,&quot;islet&quot;), values=c(&quot;#6A9AC3&quot;,&quot;#AFD699&quot;)) + scale_fill_manual(name=&quot;Population type&quot;, breaks=c(&quot;island&quot;,&quot;islet&quot;), values=c(&quot;#6A9AC350&quot;,&quot;#AFD69950&quot;)) + facet_wrap(. ~ species, scales = &quot;fixed&quot;, ncol=5) + coord_cartesian(xlim = c(1, NA)) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.x = element_text(angle = 45, hjust = 1) ) "],["beta-diversity.html", "Chapter 7 Beta diversity", " Chapter 7 Beta diversity Comparison of overall beta diversities of sampled populations. load(&quot;data/data_podarcis_all.Rdata&quot;) richness &lt;- genome_counts_filt_all %&gt;% pivot_longer(!genome,names_to=&quot;sample&quot;,values_to = &quot;counts&quot;) %&gt;% left_join(sample_metadata_all,by=&quot;sample&quot;) %&gt;% mutate(population=factor(population)) %&gt;% group_by(population) %&gt;% group_split() %&gt;% map_dbl(., ~ .x %&gt;% select(genome, sample, counts) %&gt;% pivot_wider(names_from = sample, values_from = counts) %&gt;% column_to_rownames(var = &quot;genome&quot;) %&gt;% tss() %&gt;% as.data.frame() %&gt;% hilldiss(data=., metric=&quot;C&quot;, q = 0) ) names(richness) &lt;- unique(sample_metadata_all$population) %&gt;% sort() neutral &lt;- genome_counts_filt_all %&gt;% pivot_longer(!genome,names_to=&quot;sample&quot;,values_to = &quot;counts&quot;) %&gt;% left_join(sample_metadata_all,by=&quot;sample&quot;) %&gt;% mutate(population=factor(population)) %&gt;% group_by(population) %&gt;% group_split() %&gt;% map_dbl(., ~ .x %&gt;% select(genome, sample, counts) %&gt;% pivot_wider(names_from = sample, values_from = counts) %&gt;% column_to_rownames(var = &quot;genome&quot;) %&gt;% tss() %&gt;% as.data.frame() %&gt;% hilldiss(data=., metric=&quot;C&quot;, q = 1) ) names(neutral) &lt;- unique(sample_metadata_all$population) %&gt;% sort() phylogenetic &lt;- genome_counts_filt_all %&gt;% pivot_longer(!genome,names_to=&quot;sample&quot;,values_to = &quot;counts&quot;) %&gt;% left_join(sample_metadata_all,by=&quot;sample&quot;) %&gt;% mutate(population=factor(population)) %&gt;% group_by(population) %&gt;% group_split() %&gt;% map_dbl(., ~ .x %&gt;% select(genome, sample, counts) %&gt;% pivot_wider(names_from = sample, values_from = counts) %&gt;% column_to_rownames(var = &quot;genome&quot;) %&gt;% tss() %&gt;% as.data.frame() %&gt;% hilldiss(data=., metric=&quot;C&quot;, tree=genome_tree_all, q = 1) ) names(phylogenetic) &lt;- unique(sample_metadata_all$population) %&gt;% sort() # Merge all metrics beta_div &lt;- bind_rows(richness,neutral,phylogenetic) %&gt;% t() %&gt;% as.data.frame() %&gt;% rownames_to_column(var=&quot;population&quot;) %&gt;% as_tibble() %&gt;% rename(&quot;richness&quot;=V1,&quot;neutral&quot;=V2,&quot;phylogenetic&quot;=V3) #Richness beta_div %&gt;% left_join(sample_metadata_all %&gt;% select(species,population,population_type) %&gt;% unique, by = &quot;population&quot;) %&gt;% ggplot(aes(y = richness, x = population_type, group=population_type, color=population_type, fill=population_type)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Population type&quot;, breaks=c(&quot;island&quot;,&quot;islet&quot;), values=c(&quot;#6A9AC3&quot;,&quot;#AFD699&quot;)) + scale_fill_manual(name=&quot;Population type&quot;, breaks=c(&quot;island&quot;,&quot;islet&quot;), values=c(&quot;#6A9AC350&quot;,&quot;#AFD69950&quot;)) + facet_wrap(. ~ species, scales = &quot;fixed&quot;, ncol=5) + coord_cartesian(xlim = c(1, NA)) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.x = element_text(angle = 45, hjust = 1) ) #Neutral beta_div %&gt;% left_join(sample_metadata_all %&gt;% select(species,population,population_type) %&gt;% unique, by = &quot;population&quot;) %&gt;% ggplot(aes(y = neutral, x = population_type, group=population_type, color=population_type, fill=population_type)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Population type&quot;, breaks=c(&quot;island&quot;,&quot;islet&quot;), values=c(&quot;#6A9AC3&quot;,&quot;#AFD699&quot;)) + scale_fill_manual(name=&quot;Population type&quot;, breaks=c(&quot;island&quot;,&quot;islet&quot;), values=c(&quot;#6A9AC350&quot;,&quot;#AFD69950&quot;)) + facet_wrap(. ~ species, scales = &quot;fixed&quot;, ncol=5) + coord_cartesian(xlim = c(1, NA)) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.x = element_text(angle = 45, hjust = 1) ) #Phylogenetic beta_div %&gt;% left_join(sample_metadata_all %&gt;% select(species,population,population_type) %&gt;% unique, by = &quot;population&quot;) %&gt;% ggplot(aes(y = phylogenetic, x = population_type, group=population_type, color=population_type, fill=population_type)) + geom_boxplot(outlier.shape = NA) + geom_jitter(alpha=0.5) + scale_color_manual(name=&quot;Population type&quot;, breaks=c(&quot;island&quot;,&quot;islet&quot;), values=c(&quot;#6A9AC3&quot;,&quot;#AFD699&quot;)) + scale_fill_manual(name=&quot;Population type&quot;, breaks=c(&quot;island&quot;,&quot;islet&quot;), values=c(&quot;#6A9AC350&quot;,&quot;#AFD69950&quot;)) + facet_wrap(. ~ species, scales = &quot;fixed&quot;, ncol=5) + coord_cartesian(xlim = c(1, NA)) + theme_classic() + theme( strip.background = element_blank(), panel.grid.minor.x = element_line(size = .1, color = &quot;grey&quot;), axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.x = element_text(angle = 45, hjust = 1) ) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
